<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>DFind - Maqueta de App</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <style>
            /* Variables y reset */
            :root {
                --accent: #2563eb;
                --bg: #f9fafb;
                /* azul accesible */
                --muted: #6b7280;

                --frame-bg: #1a202c;
                --warn: #facc15;
                --danger: #f87171;
            }
            .dark {
                --accent: #0f172a;
                --text-accent: rgb(96 165 250);
                --bg-surface: #0b1220;
                /* fondo principal - muy oscuro */
                --bg-elevated: #111827;
                /* tarjetas / elevaciones */
                --text-primary: #e6eef8;
                /* texto principal claro */
                --text-secondary: #9ca3af;
                /* texto secundario suave */
                --border-dark: #4c607c;
                /* bordes en tema oscuro */
                --input-bg-dark: #0b1220;
                /* campos de formulario */
                --accent: #2563eb;
                /* acento azul */
            }
            html,
            body {
                height: 100%;
                box-sizing: border-box;
                margin: 0;
            }

            body {
                font-family: 'Inter', sans-serif;
                background-color: #e5e7eb;
            }

            /* --- Tema claro / marco móvil --- */
            .mobile-frame {
                max-width: 420px;
                height: 880px;
                margin: 1.5rem auto;
            }

            .mobile-screen {
                background-color: #f7fafc;
                width: 100%;
                height: 100%;
                border-radius: 30px;
                overflow: hidden;
                position: relative;
                display: flex;
                flex-direction: column;
            }

            /* --- Dark theme: colores más contrastados y habituales en móviles --- */

            .dark .mobile-screen {
                background-color: var(--bg-surface);
                color: var(--text-primary);
            }

            .dark body {
                background-color: #000;
                /* respaldo fuera del marco */
            }

            /* tarjetas / superficies */
            .card {
                background-color: #ffffff;
                border-color: #e5e7eb;
                /* ...existing code... */
            }

            /* Evitar fondo oscuro en categorías en modo claro */
            #home-categories-list,
            #categories-list {
                background: transparent !important;
            }

            /* Pills de categorías mejorados */
            .category-pill {
                display: inline-block;
                padding: 0.5rem 1.1rem;
                border-radius: 1.5rem;
                background: #f3f4f6;
                color: #222;
                font-size: 1rem;
                font-weight: 500;
                border: 1px solid #e5e7eb;
                margin: 0.15rem 0.1rem;
                transition: box-shadow 0.18s, background 0.18s;
                box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
                text-align: center;
                min-width: 0;
                max-width: 100%;
                word-break: break-word;
            }

            .dark .category-pill {
                background: #111827;
                color: #e6eef8;
                border: 1px solid #222a36;
            }

            .category-pill:hover {
                background: #e0e7ef;
                box-shadow: 0 2px 8px rgba(37, 99, 235, 0.08);
            }

            .dark .category-pill:hover {
                background: #1a2332;
            }

            /* Eliminar llave extra que causaba error de sintaxis */
            .dark .card {
                background-color: var(--bg-elevated);
                border-color: var(--border-dark);
                color: var(--text-primary);
            }

            /* barra de navegación inferior */
            .nav-bar {
                background-color: #ffffff;
                border-top-color: #e5e7eb;
            }

            .dark .nav-bar {
                background-color: var(--bg-elevated);
                border-top-color: var(--border-dark);
            }

            .nav-button {
                color: #6b7280;
            }

            .dark .nav-button {
                color: var(--text-secondary);
            }

            .nav-button.active {
                color: #2563eb;
            }

            .dark .nav-button.active {
                color: var(--accent);
            }

            /* Inputs / selects / textareas */
            input,
            select,
            textarea {
                background-color: #fff;
                border: 1px solid #e5e7eb;
                color: #111827;
            }

            .dark input,
            .dark select,
            .dark textarea {
                background-color: var(--input-bg-dark);
                border: 1px solid var(--border-dark);
                color: var(--text-primary);
            }

            /* Placeholders más suaves en oscuro */
            .dark input::placeholder,
            .dark textarea::placeholder {
                color: #9aa4b2;
            }

            input[type='checkbox'].peer + div {
                position: relative;
                display: inline-block;
                width: 2.75rem;
                /* equivalente a w-11 */
                height: 1.5rem;
                /* equivalente a h-6 */
                border-radius: 9999px;
                background-color: #e5e7eb;
                /* OFF en claro */
                transition: background-color 0.18s ease, box-shadow 0.18s ease;
                vertical-align: middle;
                cursor: pointer;
                box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.06);
            }

            input[type='checkbox'].peer + div::after {
                content: '';
                position: absolute;
                top: 0.125rem;
                left: 0.125rem;
                width: 1.125rem;
                /* knob */
                height: 1.125rem;
                background: #ffffff;
                border-radius: 9999px;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.16);
                transition: transform 0.18s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.18s;
                transform: translateX(0);
            }

            /* Estado ON (fuerte contraste) */
            input[type='checkbox'].peer:checked + div {
                background-color: var(--accent) !important;
                box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.08) inset;
            }

            input[type='checkbox'].peer:checked + div::after {
                /* Mover knob a la derecha; valor fijo para evitar problemas con utilidades tailwind */
                transform: translateX(1.55rem) !important;
                background: #ffffff !important;
            }

            /* Dark theme: estados más contrastados */
            .dark input[type='checkbox'].peer + div {
                background-color: #374151;
                /* OFF oscuro */
                box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.6);
            }

            .dark input[type='checkbox'].peer + div::after {
                background: #0f1724;
                /* knob OFF oscuro para distinguir */
                border: 1px solid rgba(255, 255, 255, 0.06);
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.6);
            }

            .dark input[type='checkbox'].peer:checked + div {
                background-color: var(--accent) !important;
                /* ON azul legible */
                box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1) inset;
            }

            .dark input[type='checkbox'].peer:checked + div::after {
                transform: translateX(1.55rem) !important;
                background: #ffffff !important;
                box-shadow: 0 2px 8px rgba(37, 99, 235, 0.12);
            }

            /* Foco visible accesible */
            input[type='checkbox'].peer:focus + div,
            input[type='checkbox'].peer:focus-visible + div {
                outline: 3px solid rgba(37, 99, 235, 0.16);
                outline-offset: 3px;
            }

            /* Scrollbar personalizado */
            .main-content::-webkit-scrollbar {
                width: 6px;
            }

            .main-content::-webkit-scrollbar-track {
                background: transparent;
            }

            .main-content::-webkit-scrollbar-thumb {
                background-color: #cbd5e1;
                border-radius: 20px;
            }

            .dark .main-content::-webkit-scrollbar-thumb {
                background-color: #324153;
            }

            /* Sombra para botón central */
            .add-button-shadow {
                box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.28),
                    0 4px 6px -2px rgba(37, 99, 235, 0.12);
            }

            /* Asegurar que el main haga scroll correctamente dentro del contenedor flex */
            .mobile-screen main {
                flex: 1 1 auto;
                min-height: 0;
                /* importante para overflow en flex */
                overflow-y: auto;
            }

            /* Adaptaciones para safe-area y móviles pequeños */
            @media (max-width: 420px), (max-height: 800px) {
                .mobile-frame {
                    width: 100vw;
                    height: 100vh;
                    max-height: 92vh;
                    margin: 0;
                    border-radius: 0;
                    padding: env(safe-area-inset-top, 12px) env(safe-area-inset-right, 12px)
                        env(safe-area-inset-bottom, 12px) env(safe-area-inset-left, 12px);
                }

                .mobile-screen {
                    border-radius: 0;
                }

                footer.nav-bar {
                    padding-bottom: env(safe-area-inset-bottom, 12px);
                }

                .mobile-screen main {
                    padding-bottom: calc(72px + env(safe-area-inset-bottom, 0px));
                }
            }

            /* ---------- OVERRIDES PARA UTILITARIOS TAILWIND EN TEMA OSCURO ---------- */
            /* Convertir bg-white/bg-gray-* a superficies oscuras dentro de .dark */
            .dark .bg-white {
                background-color: var(--bg-elevated) !important;
                color: var(--text-primary) !important;
                border-color: var(--border-dark) !important;
            }

            .dark .bg-gray-50 {
                background-color: #07101a !important;
            }

            .dark .bg-gray-100 {
                background-color: #0b1724 !important;
            }

            /* .dark .bg-gray-200 {
                background-color: #0f1b2a !important;
            } */

            /* Texto: sustituir utilitarios grises por tonos apropiados en oscuro */
            .dark .text-gray-800,
            .dark .text-gray-700 {
                color: var(--text-primary) !important;
            }

            .dark .text-gray-600 {
                color: #9aa4b2 !important;
            }

            .dark .text-gray-500 {
                color: var(--text-secondary) !important;
            }

            .dark .text-gray-400 {
                color: #6b7280 !important;
            }

            /* Bordes en utilitarios */
            .dark .border-gray-200 {
                border-color: var(--border-dark) !important;
            }

            .dark .border {
                border-color: var(--border-dark) !important;
            }

            /* Inputs con bg-white forzados a bg oscuro */
            .dark input.bg-white,
            .dark textarea.bg-white,
            .dark select.bg-white {
                background-color: var(--input-bg-dark) !important;
                color: var(--text-primary) !important;
                border-color: var(--border-dark) !important;
            }

            /* Botones y elementos interactivos suaves */
            .dark .hover\:bg-gray-50:hover {
                background-color: rgba(255, 255, 255, 0.02) !important;
            }

            .dark .hover\:bg-gray-200:hover {
                background-color: rgba(255, 255, 255, 0.03) !important;
            }

            /* Modales */
            .dark .w-full.max-w-md.mx-auto.mt-auto.bg-white {
                background-color: var(--bg-elevated) !important;
                color: var(--text-primary) !important;
            }

            .dark .w-full.max-w-sm.p-6.bg-white {
                background-color: var(--bg-elevated) !important;
                color: var(--text-primary) !important;
            }

            /* Mantener acento azul legible */
            .dark .bg-blue-500 {
                background-color: var(--accent) !important;
            }

            /* .dark .text-blue-600 {
                color: var(--accent) !important;
            } */

            /* Botón cerrar sesión: solo borde rojo en oscuro */
            .dark .logout-btn {
                background: transparent !important;
                color: var(--text-primary) !important;
                border: 2px solid #ef4444 !important;
            }

            .dark .logout-btn:hover {
                background: rgba(239, 68, 68, 0.08) !important;
            }
            .search-results-title {
                @apply px-4 pt-4 pb-2 text-sm font-semibold text-gray-700 dark:text-gray-200;
            }

            .search-results-grid {
                @apply grid grid-cols-2 gap-x-6 gap-y-6 px-4 pb-4;
            }

            .search-card {
                @apply flex flex-col items-start text-left;
            }

            .search-card-imgWrapper {
                @apply w-32 h-32 rounded-lg overflow-hidden bg-gray-200 border border-gray-300 flex items-center justify-center dark:bg-gray-700 dark:border-gray-600;
            }

            .search-card-imgWrapper img {
                @apply w-full h-full object-cover;
            }

            .search-card-name {
                @apply mt-2 text-sm font-medium text-gray-800 leading-snug truncate dark:text-gray-100;
            }

            .search-card-location {
                @apply text-[11px] leading-tight text-gray-500 dark:text-gray-400;
            }

            /* Forzar colores del título de alerta */
            #view-alert-title {
                color: #1f2937 !important; /* gray-800 */
            }

            .dark #view-alert-title {
                color: #f3f4f6 !important; /* gray-100 */
            }
        </style>
    </head>

    <body class="bg-gray-200">
        <!-- PANTALLA LOGIN SIMPLE SEPARADA -->

        <div class="mobile-frame" id="app-frame">
            <div class="mobile-screen">
                <div
                    id="standalone-login"
                    class="fixed inset-0 z-[9999] flex items-center justify-center bg-gray-100 dark:bg-gray-900 hidden"
                >
                    <div class="w-full max-w-xs bg-white dark:bg-gray-800 rounded-xl shadow p-6">
                        <h2
                            class="text-3xl font-extrabold mb-5 text-center text-[--accent] dark:text-[--text-accent] tracking-tight"
                        >
                            DFind
                        </h2>
                        <div class="mb-4 w-full">
                            <label
                                class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1 pl-1"
                                >Usuario</label
                            >
                            <input
                                id="standalone-login-username"
                                type="text"
                                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50 dark:bg-gray-900 dark:text-white text-base"
                                placeholder="Usuario"
                                autocomplete="username"
                            />
                        </div>
                        <div class="mb-2 w-full relative">
                            <label
                                class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1 pl-1"
                                >Contraseña</label
                            >
                            <div class="relative">
                                <input
                                    id="standalone-login-password"
                                    type="password"
                                    class="w-full px-3 py-2 border border-gray-100 dark:border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50 dark:bg-gray-900 dark:text-white text-base pr-10"
                                    placeholder="Contraseña"
                                    autocomplete="current-password"
                                />
                                <button
                                    id="standalone-toggle-password"
                                    type="button"
                                    tabindex="-1"
                                    class="absolute inset-y-0 right-3 flex items-center px-3 text-gray-500 hover:text-blue-600 dark:hover:text-blue-400"
                                    style="
                                        background: none;
                                        border: none;
                                        padding: 0;
                                        cursor: pointer;
                                    "
                                >
                                    <svg
                                        id="standalone-eye-icon"
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="h-5 w-5"
                                        fill="none"
                                        viewBox="0 0 24 24"
                                        stroke="currentColor"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                                        />
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                                        />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <button
                            id="standalone-login-btn"
                            class="w-full py-2 mt-4 font-bold text-white bg-blue-600 rounded-lg shadow hover:bg-blue-700 transition-all text-base"
                        >
                            Entrar
                        </button>
                        <p
                            id="standalone-login-error"
                            class="mt-3 text-center text-red-500 text-sm hidden"
                        >
                            Usuario o contraseña incorrectos.
                        </p>
                    </div>
                </div>
                <!-- Contenido principal que cambia -->
                <main class="flex-grow overflow-y-auto main-content">
                    <!-- PANTALLA DE INICIO (DASHBOARD) -->
                    <div id="screen-home" class="p-4 space-y-6">
                        <div id="home-default-wrapper" class="space-y-6">
                            <!-- Saludo -->
                            <header class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400">Hola,</p>
                                    <h1 class="text-2xl font-bold text-gray-800 dark:text-white">
                                        Carlos
                                    </h1>
                                </div>
                                <!-- Avatar/logo clickable to go to profile -->
                                <div id="user-avatar" class="flex items-center cursor-pointer">
                                    <div
                                        class="w-10 h-10 flex items-center justify-center rounded-full bg-[--accent] text-white font-bold text-lg shadow"
                                    >
                                        C
                                    </div>
                                </div>
                            </header>

                            <!-- Alertas Próximas -->
                            <div>
                                <h2
                                    class="mb-3 text-lg font-semibold text-gray-800 dark:text-white"
                                >
                                    Alertas Próximas
                                </h2>
                                <div class="space-y-3">
                                    <div
                                        class="flex items-center p-3 space-x-3 bg-white border border-gray-200 rounded-lg shadow-sm cursor-pointer card home-alert-card"
                                    >
                                        <div class="p-2 bg-red-100 rounded-full">
                                            <svg
                                                class="w-6 h-6 text-red-500"
                                                fill="none"
                                                stroke="currentColor"
                                                viewBox="0 0 24 24"
                                                xmlns="http://www.w3.org/2000/svg"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                                                ></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <p class="font-medium text-gray-800 dark:text-gray-100">
                                                Leche caduca mañana
                                            </p>
                                            <p class="text-sm text-gray-500 dark:text-gray-400">
                                                Casa Principal ► Cocina ► Refrigerador
                                            </p>
                                        </div>
                                    </div>
                                    <div
                                        class="flex items-center p-3 space-x-3 bg-white border border-gray-200 rounded-lg shadow-sm cursor-pointer card home-alert-card"
                                    >
                                        <div class="p-2 bg-yellow-100 rounded-full">
                                            <svg
                                                class="w-6 h-6 text-yellow-500"
                                                fill="none"
                                                stroke="currentColor"
                                                viewBox="0 0 24 24"
                                                xmlns="http://www.w3.org/2000/svg"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.096 2.572-1.065z"
                                                ></path>
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                                                ></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <p class="font-medium text-gray-800 dark:text-gray-100">
                                                Mantenimiento aire acondicionado
                                            </p>
                                            <p class="text-sm text-gray-500 dark:text-gray-400">
                                                En 5 días
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Búsqueda -->
                            <div class="relative">
                                <input
                                    id="search-input"
                                    type="text"
                                    placeholder="Buscar en tu inventario..."
                                    class="w-full py-3 pl-10 pr-10 text-gray-700 bg-white border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200"
                                />

                                <!-- icono lupa -->
                                <svg
                                    class="absolute w-5 h-5 text-gray-400 left-3 top-3.5"
                                    xmlns="http://www.w3.org/2000/svg"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                                    ></path>
                                </svg>

                                <!-- botón X (oculto al inicio) -->
                                <button
                                    id="search-clear-btn"
                                    class="hidden absolute right-3 top-3.5 text-gray-400 hover:text-gray-600 dark:text-gray-300 dark:hover:text-gray-100"
                                    style="line-height: 0"
                                >
                                    <svg
                                        class="w-5 h-5"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M6 18L18 6M6 6l12 12"
                                        />
                                    </svg>
                                </button>
                            </div>

                            <!-- Categorías -->
                            <div class="hidden">
                                <div class="flex items-center justify-between mb-3">
                                    <h2 class="text-lg font-semibold text-gray-800 dark:text-white">
                                        Categorías
                                    </h2>
                                    <button
                                        id="add-category-header-btn"
                                        class="p-1 text-blue-600 rounded-full hover:bg-blue-100 dark:hover:bg-gray-700"
                                    >
                                        <svg
                                            class="w-6 h-6"
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M12 6v6m0 0v6m0-6h6m-6 0H6"
                                            ></path>
                                        </svg>
                                    </button>
                                </div>
                                <div
                                    id="home-categories-list"
                                    class="grid grid-cols-1 gap-4 pb-4 px-2 sm:grid-cols-2"
                                >
                                    <!-- Las categorías se cargarán aquí por JS -->
                                </div>
                            </div>
                            <div class="mt-6">
                                <h2
                                    class="mb-3 text-lg font-semibold text-gray-800 dark:text-white"
                                >
                                    Artículos Añadidos
                                </h2>

                                <div
                                    class="grid grid-cols-2 gap-6 justify-items-center items-center pb-4 px-4"
                                >
                                    <!-- Taladro -->
                                    <div
                                        class="w-32 text-center group cursor-pointer"
                                        data-open-object="taladro"
                                    >
                                        <div
                                            class="w-32 h-32 mb-2 overflow-hidden bg-gray-200 rounded-lg transition ring-0 group-hover:ring-4 group-hover:ring-blue-400 group-active:ring-2 group-active:ring-blue-600 flex items-center justify-center"
                                        >
                                            <img
                                                src="img/taladro.jpg"
                                                alt="Taladro Inalámbrico"
                                                class="object-cover w-full h-full transition-transform duration-150 hover:scale-105 active:scale-95 cursor-pointer"
                                            />
                                        </div>
                                        <p
                                            class="text-sm font-medium text-gray-700 truncate dark:text-gray-200"
                                        >
                                            Taladro Inalámbrico
                                        </p>
                                    </div>

                                    <!-- Pasaporte -->
                                    <div
                                        class="w-32 text-center group cursor-pointer"
                                        data-open-object="pasaporte"
                                    >
                                        <div
                                            class="w-32 h-32 mb-2 overflow-hidden bg-gray-200 rounded-lg transition ring-0 group-hover:ring-4 group-hover:ring-blue-400 group-active:ring-2 group-active:ring-blue-600 flex items-center justify-center"
                                        >
                                            <img
                                                src="img/pasaporte.jpg"
                                                alt="Pasaporte"
                                                class="object-cover w-full h-full transition-transform duration-150 hover:scale-105 active:scale-95 cursor-pointer"
                                            />
                                        </div>
                                        <p
                                            class="text-sm font-medium text-gray-700 truncate dark:text-gray-200"
                                        >
                                            Pasaporte
                                        </p>
                                    </div>

                                    <!-- Televisión -->
                                    <div
                                        class="w-32 text-center group cursor-pointer"
                                        data-open-object="tele"
                                    >
                                        <div
                                            class="w-32 h-32 mb-2 overflow-hidden bg-gray-200 rounded-lg transition ring-0 group-hover:ring-4 group-hover:ring-blue-400 group-active:ring-2 group-active:ring-blue-600 flex items-center justify-center"
                                        >
                                            <img
                                                src="img/tele.jpg"
                                                alt="Televisión Salón"
                                                class="object-cover w-full h-full transition-transform duration-150 hover:scale-105 active:scale-95 cursor-pointer"
                                            />
                                        </div>
                                        <p
                                            class="text-sm font-medium text-gray-700 truncate dark:text-gray-200"
                                        >
                                            Televisión Salón
                                        </p>
                                    </div>

                                    <!-- Libro -->
                                    <div
                                        class="w-32 text-center group cursor-pointer"
                                        data-open-object="libro"
                                    >
                                        <div
                                            class="w-32 h-32 mb-2 overflow-hidden bg-gray-200 rounded-lg transition ring-0 group-hover:ring-4 group-hover:ring-blue-400 group-active:ring-2 group-active:ring-blue-600 flex items-center justify-center"
                                        >
                                            <img
                                                src="img/libro.jpg"
                                                alt="Libro 'El Hobbit'"
                                                class="object-cover w-full h-full transition-transform duration-150 hover:scale-105 active:scale-95 cursor-pointer"
                                            />
                                        </div>
                                        <p
                                            class="text-sm font-medium text-gray-700 truncate dark:text-gray-200"
                                        >
                                            Libro 'El Hobbit'
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="home-search-wrapper" class="space-y-4 hidden">
                            <!-- misma barra de búsqueda pero aquí la X sirve como "regresar" -->
                            <div class="relative">
                                <input
                                    id="search-input-active"
                                    type="text"
                                    placeholder="Buscar en tu inventario..."
                                    class="w-full py-3 pl-10 pr-10 text-gray-700 bg-white border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200"
                                />

                                <svg
                                    class="absolute w-5 h-5 text-gray-400 left-3 top-3.5"
                                    xmlns="http://www.w3.org/2000/svg"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                                    ></path>
                                </svg>

                                <button
                                    id="search-exit-btn"
                                    class="absolute right-3 top-3 text-gray-400 hover:text-gray-600 dark:text-gray-300 dark:hover:text-gray-100"
                                    style="line-height: 0"
                                >
                                    <svg
                                        class="w-5 h-5"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M6 18L18 6M6 6l12 12"
                                        />
                                    </svg>
                                </button>
                            </div>

                            <!-- Resultados -->
                            <div
                                id="home-search-results"
                                class="bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden dark:bg-gray-800 dark:border-gray-700"
                            >
                                <!-- se llena con JS -->
                            </div>
                        </div>
                    </div>

                    <!-- PANTALLA DE INVENTARIO -->
                    <div id="screen-inventory" class="hidden p-4">
                        <div id="inventory-nav-header" class="flex items-center mb-4">
                            <h1 class="text-2xl font-bold text-gray-800 dark:text-white">
                                Inventario
                            </h1>
                        </div>
                        <div id="inventory-content" class="space-y-3">
                            <!-- El contenido se generará con JS -->
                        </div>
                    </div>

                    <!-- PANTALLA DE RESULTADOS DE BÚSQUEDA -->
                    <div id="screen-search-results" class="hidden p-4">
                        <div id="search-nav-header" class="flex items-center mb-4">
                            <button
                                id="search-back-btn"
                                class="p-2 mr-3 -ml-2 text-gray-600 rounded-full hover:bg-gray-200 dark:text-gray-300 dark:hover:bg-gray-700"
                            >
                                <svg
                                    class="w-6 h-6"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M15 19l-7-7 7-7"
                                    ></path>
                                </svg>
                            </button>
                            <h1 class="text-2xl font-bold text-gray-800 dark:text-white">
                                Resultados de Búsqueda
                            </h1>
                        </div>
                        <div id="search-results-content" class="space-y-3">
                            <!-- Los resultados de la búsqueda aparecerán aquí -->
                        </div>
                    </div>

                    <!-- PANTALLA DE ALERTAS (NUEVA LÓGICA) -->
                    <div id="screen-alerts" class="hidden p-4 pb-24">
                        <div class="flex items-center justify-between mb-4">
                            <h1 class="text-2xl font-bold text-gray-800 dark:text-white">
                                Alertas
                            </h1>
                            <button
                                id="alert-edit-btn"
                                class="hidden px-4 py-2 text-sm font-semibold text-blue-600 bg-blue-100 rounded-lg dark:bg-blue-900 dark:text-blue-200"
                            >
                                Seleccionar
                            </button>
                        </div>
                        <button
                            id="open-alert-modal-btn"
                            class="absolute z-40 w-16 h-16 text-white bg-blue-600 rounded-full add-button-shadow bottom-24 right-6 inline-flex items-center justify-center hover:bg-blue-700 transition-all duration-200"
                        >
                            <div class="relative">
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="w-6 h-6"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h11"
                                    />
                                </svg>
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="absolute -top-1 -right-1 w-3 h-3 bg-white text-blue-600 rounded-full"
                                    fill="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"
                                    />
                                </svg>
                            </div>
                        </button>

                        <div class="flex mb-4 border-b border-gray-200 dark:border-gray-700">
                            <button
                                id="alert-tab-actuales"
                                data-tab="actuales"
                                class="flex-1 py-2 font-semibold text-blue-600 border-b-2 border-blue-600 alert-tab"
                            >
                                Actuales
                            </button>
                            <button
                                id="alert-tab-past"
                                data-tab="past"
                                class="flex-1 py-2 font-semibold text-gray-500 alert-tab dark:text-gray-400"
                            >
                                Pasadas
                            </button>
                        </div>

                        <div id="alert-list-actuales" class="space-y-6 alert-list">
                            <div>
                                <div id="alert-list-importantes" class="space-y-3"></div>
                            </div>
                            <div>
                                <h2
                                    class="mb-3 text-lg font-semibold text-gray-800 dark:text-white"
                                >
                                    Próximas
                                </h2>
                                <div id="alert-list-proximas" class="space-y-3"></div>
                            </div>
                            <div>
                                <h2
                                    class="mb-3 text-lg font-semibold text-gray-500 dark:text-gray-400"
                                >
                                    Desactivadas
                                </h2>
                                <div id="alert-list-desactivadas" class="space-y-3"></div>
                            </div>
                        </div>

                        <div id="alert-list-past" class="hidden space-y-3 alert-list">
                            <!-- Alertas pasadas se renderizarán aquí -->
                        </div>
                    </div>

                    <!-- PANTALLA DE PERFIL -->
                    <div id="screen-profile" class="hidden">
                        <div class="h-32 bg-blue-500"></div>
                        <div class="p-4 -mt-16">
                            <div class="flex flex-col items-center mb-6">
                                <div
                                    class="w-24 h-24 mb-2 bg-gray-300 rounded-full overflow-hidden ring-4 ring-white dark:ring-gray-800"
                                >
                                    <img
                                        src="https://placehold.co/100x100/E2E8F0/4A5568?text=C"
                                        alt="Avatar de usuario"
                                        class="object-cover w-full h-full"
                                    />
                                </div>
                                <h1 class="text-xl font-bold">Carlos Rodríguez</h1>
                                <p class="text-sm text-gray-500">carlos.r@email.com</p>
                            </div>

                            <div class="space-y-4">
                                <div>
                                    <h3 class="px-2 mb-2 text-sm font-semibold text-gray-500">
                                        Gestión
                                    </h3>
                                    <div class="bg-white rounded-lg shadow-sm card">
                                        <button
                                            id="nav-to-properties"
                                            class="flex items-center justify-between w-full p-4 text-left border-b dark:border-gray-600"
                                        >
                                            <span>Mis Propiedades</span>
                                            <svg
                                                class="w-5 h-5 text-gray-400"
                                                fill="none"
                                                stroke="currentColor"
                                                viewBox="0 0 24 24"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M9 5l7 7-7 7"
                                                ></path>
                                            </svg>
                                        </button>
                                        <button
                                            id="nav-to-categories"
                                            class="flex items-center justify-between w-full p-4 text-left"
                                        >
                                            <span>Mis Categorías</span>
                                            <svg
                                                class="w-5 h-5 text-gray-400"
                                                fill="none"
                                                stroke="currentColor"
                                                viewBox="0 0 24 24"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M9 5l7 7-7 7"
                                                ></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="px-2 mb-2 text-sm font-semibold text-gray-500">
                                        Configuración
                                    </h3>
                                    <div class="bg-white rounded-lg shadow-sm card overflow-hidden">
                                        <!-- FILA: Notificaciones + switch + ícono de config -->
                                        <div
                                            class="flex items-center justify-between p-4 border-b dark:border-gray-600"
                                        >
                                            <div class="flex flex-col">
                                                <span
                                                    class="font-medium text-gray-800 dark:text-white"
                                                    >Notificaciones</span
                                                >
                                                <span
                                                    class="text-xs text-gray-500 dark:text-gray-400"
                                                    >Controla alertas y avisos de la app</span
                                                >
                                            </div>

                                            <div class="flex items-center space-x-3">
                                                <!-- Botón engranaje (aparece solo si notif está activado) -->
                                                <button
                                                    id="notif-config-btn"
                                                    class="hidden text-gray-500 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400"
                                                    aria-label="Configurar notificaciones"
                                                >
                                                    <!-- ícono engranaje -->
                                                    <svg
                                                        class="w-6 h-6"
                                                        fill="none"
                                                        stroke="currentColor"
                                                        stroke-width="2"
                                                        viewBox="0 0 24 24"
                                                    >
                                                        <path
                                                            stroke-linecap="round"
                                                            stroke-linejoin="round"
                                                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.096 2.572-1.065z"
                                                        ></path>
                                                        <path
                                                            stroke-linecap="round"
                                                            stroke-linejoin="round"
                                                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                                                        />
                                                    </svg>
                                                </button>

                                                <!-- Switch general de notificaciones -->
                                                <label
                                                    class="relative inline-flex items-center cursor-pointer"
                                                >
                                                    <input
                                                        id="notif-switch"
                                                        type="checkbox"
                                                        class="sr-only peer"
                                                    />
                                                    <div
                                                        class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"
                                                    ></div>
                                                </label>
                                            </div>
                                        </div>

                                        <!-- PANEL DE PERSONALIZACIÓN (colapsado por defecto) -->
                                        <div
                                            id="notif-config-panel"
                                            class="hidden border-b dark:border-gray-600 bg-white dark:bg-gray-800"
                                        >
                                            <!-- IMPORTANCIA ALTA -->
                                            <div
                                                class="px-4 py-3 border-t border-gray-200 dark:border-gray-700"
                                            >
                                                <div class="flex items-start justify-between">
                                                    <div class="flex flex-col">
                                                        <span
                                                            class="text-gray-800 dark:text-gray-100 font-medium"
                                                            >Importancia Alta</span
                                                        >
                                                        <span
                                                            class="text-xs text-gray-500 dark:text-gray-400"
                                                        >
                                                            Alertas urgentes (por ejemplo: “caduca
                                                            mañana”)
                                                        </span>
                                                    </div>
                                                </div>

                                                <div class="mt-3 space-y-2 pl-2">
                                                    <!-- Alta sonido -->
                                                    <div class="flex items-center justify-between">
                                                        <span
                                                            class="text-sm text-gray-800 dark:text-gray-100"
                                                            >Sonido</span
                                                        >
                                                        <label
                                                            class="relative inline-flex items-center cursor-pointer"
                                                        >
                                                            <input
                                                                id="notif_high_sound"
                                                                type="checkbox"
                                                                class="sr-only peer"
                                                            />
                                                            <div
                                                                class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"
                                                            ></div>
                                                        </label>
                                                    </div>
                                                    <!-- Alta vibración -->
                                                    <div class="flex items-center justify-between">
                                                        <span
                                                            class="text-sm text-gray-800 dark:text-gray-100"
                                                            >Vibración</span
                                                        >
                                                        <label
                                                            class="relative inline-flex items-center cursor-pointer"
                                                        >
                                                            <input
                                                                id="notif_high_vibration"
                                                                type="checkbox"
                                                                class="sr-only peer default-vibration"
                                                            />
                                                            <div
                                                                class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"
                                                            ></div>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- IMPORTANCIA MEDIA -->
                                            <div
                                                class="px-4 py-3 border-t border-gray-200 dark:border-gray-700"
                                            >
                                                <div class="flex items-start justify-between">
                                                    <div class="flex flex-col">
                                                        <span
                                                            class="text-gray-800 dark:text-gray-100 font-medium"
                                                            >Importancia Media</span
                                                        >
                                                        <span
                                                            class="text-xs text-gray-500 dark:text-gray-400"
                                                        >
                                                            Recordatorios próximos
                                                        </span>
                                                    </div>
                                                </div>

                                                <div class="mt-3 space-y-2 pl-2">
                                                    <!-- Media sonido -->
                                                    <div class="flex items-center justify-between">
                                                        <span
                                                            class="text-sm text-gray-800 dark:text-gray-100"
                                                            >Sonido</span
                                                        >
                                                        <label
                                                            class="relative inline-flex items-center cursor-pointer"
                                                        >
                                                            <input
                                                                id="notif_medium_sound"
                                                                type="checkbox"
                                                                class="sr-only peer"
                                                            />
                                                            <div
                                                                class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"
                                                            ></div>
                                                        </label>
                                                    </div>
                                                    <!-- Media vibración -->
                                                    <div class="flex items-center justify-between">
                                                        <span
                                                            class="text-sm text-gray-800 dark:text-gray-100"
                                                            >Vibración</span
                                                        >
                                                        <label
                                                            class="relative inline-flex items-center cursor-pointer"
                                                        >
                                                            <input
                                                                id="notif_medium_vibration"
                                                                type="checkbox"
                                                                class="sr-only peer default-vibration"
                                                            />
                                                            <div
                                                                class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"
                                                            ></div>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- IMPORTANCIA BAJA -->
                                            <div
                                                class="px-4 py-3 border-t border-gray-200 dark:border-gray-700"
                                            >
                                                <div class="flex items-start justify-between">
                                                    <div class="flex flex-col">
                                                        <span
                                                            class="text-gray-800 dark:text-gray-100 font-medium"
                                                            >Importancia Baja</span
                                                        >
                                                        <span
                                                            class="text-xs text-gray-500 dark:text-gray-400"
                                                        >
                                                            Cosas informativas, no urgentes
                                                        </span>
                                                    </div>
                                                </div>

                                                <div class="mt-3 space-y-2 pl-2">
                                                    <!-- Baja sonido -->
                                                    <div class="flex items-center justify-between">
                                                        <span
                                                            class="text-sm text-gray-800 dark:text-gray-100"
                                                            >Sonido</span
                                                        >
                                                        <label
                                                            class="relative inline-flex items-center cursor-pointer"
                                                        >
                                                            <input
                                                                id="notif_low_sound"
                                                                type="checkbox"
                                                                class="sr-only peer"
                                                            />
                                                            <div
                                                                class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"
                                                            ></div>
                                                        </label>
                                                    </div>
                                                    <!-- Baja vibración -->
                                                    <div class="flex items-center justify-between">
                                                        <span
                                                            class="text-sm text-gray-800 dark:text-gray-100"
                                                            >Vibración</span
                                                        >
                                                        <label
                                                            class="relative inline-flex items-center cursor-pointer"
                                                        >
                                                            <input
                                                                id="notif_low_vibration"
                                                                type="checkbox"
                                                                class="sr-only peer default-vibration"
                                                            />
                                                            <div
                                                                class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"
                                                            ></div>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- GENERALES DE LA APP -->
                                            <div
                                                class="px-4 py-3 border-t border-gray-200 dark:border-gray-700"
                                            >
                                                <div class="flex items-start justify-between">
                                                    <div class="flex flex-col">
                                                        <span
                                                            class="text-gray-800 dark:text-gray-100 font-medium"
                                                            >Generales de la App</span
                                                        >
                                                        <span
                                                            class="text-xs text-gray-500 dark:text-gray-400"
                                                        >
                                                            Novedades, avisos generales
                                                        </span>
                                                    </div>
                                                </div>

                                                <div class="mt-3 space-y-2 pl-2">
                                                    <!-- General sonido -->
                                                    <div class="flex items-center justify-between">
                                                        <span
                                                            class="text-sm text-gray-800 dark:text-gray-100"
                                                            >Sonido</span
                                                        >
                                                        <label
                                                            class="relative inline-flex items-center cursor-pointer"
                                                        >
                                                            <input
                                                                id="notif_low_sound"
                                                                type="checkbox"
                                                                class="sr-only peer"
                                                            />
                                                            <div
                                                                class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"
                                                            ></div>
                                                        </label>
                                                    </div>
                                                    <!-- Baja vibración -->
                                                    <div class="flex items-center justify-between">
                                                        <span
                                                            class="text-sm text-gray-800 dark:text-gray-100"
                                                            >Vibración</span
                                                        >
                                                        <label
                                                            class="relative inline-flex items-center cursor-pointer"
                                                        >
                                                            <input
                                                                id="notif_low_vibration"
                                                                type="checkbox"
                                                                class="sr-only peer default-vibration"
                                                            />
                                                            <div
                                                                class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"
                                                            ></div>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- TEMA OSCURO -->
                                        <div class="flex items-center justify-between p-4">
                                            <span class="text-gray-800 dark:text-white"
                                                >Tema Oscuro</span
                                            >
                                            <label
                                                class="relative inline-flex items-center cursor-pointer"
                                            >
                                                <input
                                                    type="checkbox"
                                                    id="theme-toggle"
                                                    class="sr-only peer"
                                                />
                                                <div
                                                    class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"
                                                ></div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <button
                                    id="logout-btn"
                                    class="w-full py-3 font-semibold text-red-600 bg-white border border-red-200 rounded-lg card"
                                >
                                    Cerrar Sesión
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- PANTALLA CRUD MIS PROPIEDADES -->
                    <div id="screen-properties" class="hidden p-4">
                        <div class="flex items-center mb-4">
                            <button
                                id="properties-back-btn"
                                class="p-2 mr-3 -ml-2 text-gray-600 rounded-full hover:bg-gray-200 dark:text-gray-300 dark:hover:bg-gray-700"
                            >
                                <svg
                                    class="w-6 h-6"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M15 19l-7-7 7-7"
                                    ></path>
                                </svg>
                            </button>
                            <h1 class="text-2xl font-bold text-gray-800 dark:text-white">
                                Mis Propiedades
                            </h1>
                        </div>
                        <div id="properties-list" class="space-y-3">
                            <!-- Lista de propiedades se generará aquí -->
                        </div>
                        <button
                            id="add-property-crud-btn"
                            class="w-full py-3 mt-4 font-semibold text-blue-600 border-2 border-blue-500 border-dashed rounded-lg hover:bg-blue-50 dark:hover:bg-gray-700"
                        >
                            + Añadir Propiedad
                        </button>
                    </div>

                    <!-- PANTALLA CRUD MIS CATEGORÍAS -->
                    <div id="screen-categories" class="hidden p-4">
                        <div class="flex items-center mb-4">
                            <button
                                id="categories-back-btn"
                                class="p-2 mr-3 -ml-2 text-gray-600 rounded-full hover:bg-gray-200 dark:text-gray-300 dark:hover:bg-gray-700"
                            >
                                <svg
                                    class="w-6 h-6"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M15 19l-7-7 7-7"
                                    ></path>
                                </svg>
                            </button>
                            <h1 class="text-2xl font-bold text-gray-800 dark:text-white">
                                Mis Categorías
                            </h1>
                        </div>
                        <div id="categories-list" class="space-y-3">
                            <!-- Lista de categorías se generará aquí -->
                        </div>
                        <button
                            id="add-category-crud-btn"
                            class="w-full py-3 mt-4 font-semibold text-blue-600 border-2 border-blue-500 border-dashed rounded-lg hover:bg-blue-50 dark:hover:bg-gray-700"
                        >
                            + Añadir Categoría
                        </button>
                    </div>

                    <!-- MODAL PARA AÑADIR OBJETO -->
                    <div
                        id="modal-add-object"
                        class="fixed inset-0 z-50 flex-col hidden bg-gray-900 bg-opacity-75"
                    >
                        <div
                            class="w-full h-full max-w-md mx-auto mt-auto bg-white rounded-t-2xl dark:bg-gray-800"
                        >
                            <div
                                class="flex items-center justify-between p-4 border-b dark:border-gray-700"
                            >
                                <h2 class="text-xl font-bold">Añadir Nuevo Objeto</h2>
                                <button
                                    id="close-modal-btn"
                                    class="text-gray-500 text-3xl leading-none"
                                >
                                    &times;
                                </button>
                            </div>
                            <div
                                class="p-4 space-y-4 overflow-y-auto"
                                style="max-height: calc(100% - 120px)"
                            >
                                <!-- Paso 1 -->
                                <div>
                                    <label class="font-semibold">1. ¿Qué es?</label>
                                    <div
                                        class="flex items-center justify-center w-full h-32 mt-2 bg-gray-100 border-2 border-dashed rounded-lg dark:bg-gray-700 dark:border-gray-600"
                                    >
                                        <div class="text-center text-gray-500">
                                            <svg
                                                class="w-8 h-8 mx-auto mb-2"
                                                fill="none"
                                                stroke="currentColor"
                                                viewBox="0 0 24 24"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"
                                                ></path>
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                                                ></path>
                                            </svg>
                                            <p>Tocar para añadir foto</p>
                                        </div>
                                    </div>
                                    <input
                                        id="modal-object-name"
                                        type="text"
                                        placeholder="* Nombre del Objeto"
                                        class="w-full p-2 mt-2 border rounded"
                                    />
                                    <textarea
                                        placeholder="Descripción (opcional)"
                                        class="w-full p-2 mt-2 border rounded"
                                        rows="2"
                                    ></textarea>
                                    <select
                                        class="w-full p-3 mt-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200"
                                    >
                                        <option>Seleccionar Categoría</option>
                                        <option>Electrónica</option>
                                        <option>Documentos</option>
                                        <option>Herramientas</option>
                                        <option>Alimentos</option>
                                    </select>
                                </div>
                                <!-- Paso 2 y 3 -->
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="font-semibold">2. Cantidad</label>
                                        <input
                                            type="number"
                                            value="1"
                                            class="w-full p-2 mt-2 border rounded"
                                        />
                                    </div>
                                    <div>
                                        <label class="font-semibold">Unidad</label>
                                        <select
                                            class="w-full p-3 mt-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200"
                                        >
                                            <option>Unidades</option>
                                            <option>kg</option>
                                            <option>Litros</option>
                                        </select>
                                    </div>
                                </div>
                                <div>
                                    <label class="font-semibold">3. ¿Dónde está?</label>
                                    <select
                                        id="location-object"
                                        class="w-full p-3 mt-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200"
                                    ></select>
                                </div>
                                <!-- Pasos opcionales -->
                                <div>
                                    <details>
                                        <summary class="font-semibold text-blue-600 cursor-pointer">
                                            Detalles y Alertas (Opcional)
                                        </summary>
                                        <div
                                            class="p-3 mt-2 space-y-4 bg-gray-50 rounded-lg dark:bg-gray-700"
                                        >
                                            <input
                                                type="number"
                                                placeholder="Costo"
                                                class="w-full p-2 border rounded"
                                            />
                                            <div>
                                                <label
                                                    class="text-sm text-gray-600 dark:text-gray-300"
                                                    >Fecha de compra</label
                                                >
                                                <input
                                                    type="date"
                                                    class="w-full p-2 border rounded"
                                                />
                                            </div>
                                            <button
                                                class="w-full py-2 text-sm font-semibold text-blue-600 border-2 border-blue-500 border-dashed rounded-lg"
                                            >
                                                + Añadir Alerta
                                            </button>
                                        </div>
                                    </details>
                                </div>
                            </div>
                            <div class="p-4">
                                <button
                                    id="save-object-btn"
                                    class="w-full py-3 font-bold text-white bg-blue-600 rounded-lg"
                                >
                                    Guardar Objeto
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- MODAL PARA AÑADIR ELEMENTO GENÉRICO (Propiedad, Habitación, etc.) -->
                    <div
                        id="modal-add-generic"
                        class="fixed inset-0 z-50 items-center justify-center hidden bg-gray-900 bg-opacity-75"
                    >
                        <div
                            class="w-full max-w-sm p-6 bg-white rounded-lg shadow-xl dark:bg-gray-800"
                        >
                            <h2 id="modal-generic-title" class="mb-4 text-xl font-bold">
                                Añadir Elemento
                            </h2>
                            <input
                                id="modal-generic-input"
                                type="text"
                                placeholder="Nombre del elemento"
                                class="w-full p-3 mb-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200"
                            />
                            <div class="flex justify-end space-x-3">
                                <button
                                    id="modal-generic-cancel"
                                    class="px-4 py-2 bg-gray-200 text-black rounded-lg font-semibold hover:bg-gray-300 transition dark:bg-gray-700 dark:text-black dark:hover:bg-gray-600 dark:border dark:border-gray-600"
                                >
                                    Cancelar
                                </button>
                                <button
                                    id="modal-generic-save"
                                    class="px-4 py-2 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700"
                                >
                                    Guardar
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- NUEVO MODAL: AÑADIR/EDITAR ALERTA -->
                    <div
                        id="modal-add-alert"
                        class="fixed inset-0 z-50 flex-col hidden bg-gray-900 bg-opacity-75"
                    >
                        <div
                            class="w-full h-full max-w-md mx-auto mt-auto bg-white rounded-t-2xl dark:bg-gray-800"
                        >
                            <div
                                class="flex items-center justify-between p-4 border-b dark:border-gray-700"
                            >
                                <h2 id="alert-modal-title" class="text-xl font-bold">
                                    Añadir Nueva Alerta
                                </h2>
                                <button
                                    id="close-alert-modal-btn"
                                    class="text-gray-500 text-3xl leading-none"
                                >
                                    &times;
                                </button>
                            </div>
                            <form>
                                <div
                                    class="p-4 space-y-4 overflow-y-auto"
                                    style="max-height: calc(100% - 120px)"
                                >
                                    <div>
                                        <label for="alert-title" class="text-sm font-medium"
                                            >Título*</label
                                        >
                                        <input
                                            id="alert-title"
                                            type="text"
                                            required
                                            placeholder="Ej: Caducidad de la leche"
                                            class="w-full p-2 mt-1 border rounded"
                                        />
                                    </div>
                                    <div>
                                        <label for="alert-description" class="text-sm font-medium"
                                            >Descripción</label
                                        >
                                        <textarea
                                            id="alert-description"
                                            placeholder="Descripción detallada (opcional)"
                                            class="w-full p-2 mt-1 border rounded"
                                            rows="2"
                                        ></textarea>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label for="alert-date" class="text-sm font-medium"
                                                >Fecha*</label
                                            >
                                            <input
                                                id="alert-date"
                                                type="date"
                                                required
                                                class="w-full p-2 mt-1 border rounded"
                                            />
                                        </div>
                                        <div>
                                            <label for="alert-priority" class="text-sm font-medium"
                                                >Prioridad</label
                                            >
                                            <select
                                                id="alert-priority"
                                                class="w-full p-2 mt-1 border rounded"
                                            >
                                                <option value="baja">Baja</option>
                                                <option value="media">Media</option>
                                                <option value="alta">Alta</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="alert-location" class="text-sm font-medium"
                                            >Asociar a Ubicación (Opcional)</label
                                        >
                                        <select
                                            id="alert-location"
                                            class="w-full p-3 mt-1 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200"
                                        >
                                            <option value="">Ninguna</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="alert-object" class="text-sm font-medium"
                                            >Asociar a Objeto (Opcional)</label
                                        >
                                        <select
                                            id="alert-object"
                                            class="w-full p-3 mt-1 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200"
                                        >
                                            <option value="">Ninguno</option>
                                        </select>
                                    </div>
                                    <div class="space-y-2">
                                        <div class="flex items-center">
                                            <input
                                                id="alert-repetitive"
                                                type="checkbox"
                                                class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                                            />
                                            <label
                                                for="alert-repetitive"
                                                class="ml-2 block text-sm"
                                            >
                                                ¿Es una alerta repetitiva?
                                            </label>
                                        </div>
                                        <div id="alert-repeat-options" class="hidden pl-6">
                                            <label
                                                for="alert-repeat-frequency"
                                                class="text-sm font-medium"
                                                >Repetir cada:</label
                                            >
                                            <select
                                                id="alert-repeat-frequency"
                                                class="w-full p-2 mt-1 border rounded"
                                            >
                                                <option value="semanal">Semana</option>
                                                <option value="mensual">Mes</option>
                                                <option value="anual">Año</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-4">
                                    <button
                                        id="save-alert-btn"
                                        class="w-full py-3 font-bold text-white bg-blue-600 rounded-lg"
                                    >
                                        Guardar Alerta
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- NUEVO MODAL: VER ALERTA -->
                    <div
                        id="modal-view-alert"
                        class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75 font-sans hidden"
                    >
                        <div
                            class="relative w-full max-w-sm rounded-2xl bg-white dark:bg-slate-900 p-8 shadow-2xl ring-1 ring-gray-200 dark:ring-white/10"
                        >
                            <button
                                id="alert-modal-cancel"
                                class="absolute right-4 top-4 text-gray-400 dark:text-slate-400 transition-colors hover:text-gray-600 dark:hover:text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-slate-600 focus:ring-offset-2 focus:ring-offset-white dark:focus:ring-offset-slate-900"
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="h-6 w-6"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        d="M6 18L18 6M6 6l12 12"
                                    />
                                </svg>
                            </button>

                            <div class="flex flex-col">
                                <h2
                                    id="view-alert-title"
                                    class="text-xl font-bold text-gray-800 dark:text-gray-100"
                                >
                                    Mantenimiento aire acondicionado
                                </h2>
                                <div
                                    id="view-alert-date"
                                    class="mt-1.5 flex items-center gap-2 text-sm text-gray-500 dark:text-slate-400"
                                >
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="h-4 w-4"
                                        viewBox="0 0 20 20"
                                        fill="currentColor"
                                    >
                                        <path
                                            fill-rule="evenodd"
                                            d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z"
                                            clip-rule="evenodd"
                                        />
                                    </svg>
                                    <span>En 2 días (Repite anual)</span>
                                </div>
                            </div>

                            <hr class="my-4 border-gray-200 dark:border-slate-700" />

                            <div class="flex flex-col space-y-3 text-gray-700 dark:text-slate-300">
                                <p id="view-alert-description" class="text-base">
                                    Llamar al técnico.
                                </p>

                                <div class="flex flex-col space-y-3 pt-2">
                                    <div class="flex items-start gap-3">
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            class="h-5 w-5 flex-shrink-0 text-gray-400 dark:text-slate-400"
                                            viewBox="0 0 20 20"
                                            fill="currentColor"
                                        >
                                            <path
                                                d="M5 3a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2V5a2 2 0 00-2-2H5zm0 2h10v7h-2V7a1 1 0 00-1-1H6V5z"
                                            />
                                        </svg>
                                        <div class="flex flex-col text-sm">
                                            <span
                                                class="font-semibold text-gray-500 dark:text-slate-400"
                                                >Artículo</span
                                            >
                                            <span id="view-alert-object"
                                                >Aire Acondicionado Split</span
                                            >
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-3">
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            class="h-5 w-5 flex-shrink-0 text-gray-400 dark:text-slate-400"
                                            viewBox="0 0 20 20"
                                            fill="currentColor"
                                        >
                                            <path
                                                fill-rule="evenodd"
                                                d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"
                                                clip-rule="evenodd"
                                            />
                                        </svg>
                                        <div class="flex flex-col text-sm">
                                            <span
                                                class="font-semibold text-gray-500 dark:text-slate-400"
                                                >Lugar</span
                                            >
                                            <span id="view-alert-location"
                                                >Casa Principal ▸ Dormitorio Principal</span
                                            >
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <hr class="my-4 border-gray-200 dark:border-slate-700" />

                            <div id="view-alert-buttons" class="flex flex-col space-y-3">
                                <button
                                    id="alert-modal-modify"
                                    class="flex w-full items-center justify-center gap-2 rounded-lg bg-[--accent] px-4 py-2 text-sm font-semibold text-white shadow-sm transition-colors hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-white dark:focus:ring-offset-slate-900"
                                >
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="h-4 w-4"
                                        viewBox="0 0 20 20"
                                        fill="currentColor"
                                    >
                                        <path
                                            d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"
                                        />
                                        <path
                                            fill-rule="evenodd"
                                            d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"
                                            clip-rule="evenodd"
                                        />
                                    </svg>
                                    <span>Modificar</span>
                                </button>

                                <div class="grid grid-cols-2 gap-3">
                                    <button
                                        id="alert-modal-delete"
                                        class="flex w-full items-center justify-center gap-2 rounded-lg border border-rose-700 px-4 py-2 text-sm font-semibold text-[--danger] shadow-sm transition-colors hover:bg-rose-700 hover:text-white focus:outline-none focus:ring-2 focus:ring-rose-500 focus:ring-offset-2 focus:ring-offset-white dark:focus:ring-offset-slate-900"
                                    >
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            class="h-4 w-4"
                                            viewBox="0 0 20 20"
                                            fill="currentColor"
                                        >
                                            <path
                                                fill-rule="evenodd"
                                                d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z"
                                                clip-rule="evenodd"
                                            />
                                        </svg>
                                        <span>Eliminar</span>
                                    </button>

                                    <button
                                        id="alert-modal-deactivate"
                                        class="flex w-full items-center justify-center gap-2 rounded-lg border border-amber-500 px-4 py-2 text-sm font-semibold text-amber-500 shadow-sm transition-colors hover:bg-amber-500 hover:text-white focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-2 focus:ring-offset-white dark:focus:ring-offset-slate-900"
                                    >
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            class="h-4 w-4"
                                            viewBox="0 0 20 20"
                                            fill="currentColor"
                                        >
                                            <path
                                                fill-rule="evenodd"
                                                d="M13.477 14.89A6 6 0 015.11 6.524l8.367 8.367zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z"
                                                clip-rule="evenodd"
                                            />
                                        </svg>
                                        <span>Desactivar</span>
                                    </button>

                                    <button
                                        id="alert-modal-reactivate"
                                        class="col-span-2 flex w-full items-center justify-center gap-2 rounded-lg bg-teal-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition-colors hover:bg-teal-500 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 focus:ring-offset-white dark:focus:ring-offset-slate-900"
                                    >
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            class="h-4 w-4"
                                            viewBox="0 0 20 20"
                                            fill="currentColor"
                                        >
                                            <path
                                                fill-rule="evenodd"
                                                d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                                clip-rule="evenodd"
                                            />
                                        </svg>
                                        <span>Reactivar</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PANTALLA DETALLE / EDITAR OBJETO -->
                    <div id="screen-object-detail" class="hidden p-4 pb-24">
                        <!-- header con back -->
                        <div class="flex items-center mb-4">
                            <button
                                id="object-detail-back-btn"
                                class="p-2 mr-3 -ml-2 text-gray-600 rounded-full hover:bg-gray-200 dark:text-gray-300 dark:hover:bg-gray-700"
                            >
                                <svg
                                    class="w-6 h-6"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M15 19l-7-7 7-7"
                                    ></path>
                                </svg>
                            </button>
                            <h1 class="text-2xl font-bold text-gray-800 dark:text-white">
                                Detalle del Artículo
                            </h1>
                        </div>

                        <!-- HEADER: imagen SIEMPRE a la izquierda (también en móvil) + nombre/descripcion a la derecha -->
                    <div class="grid grid-cols-[110px_1fr] md:grid-cols-[260px_1fr] gap-3 md:gap-4 mb-4 items-start">
                    <!-- Imagen izquierda: tamaño fijo (el contenedor NO crece), la imagen se adapta -->
                    <div
                        class="relative w-[110px] h-[146px] md:w-64 md:h-80 shrink-0 overflow-hidden rounded-xl border border-gray-300
                            bg-gradient-to-br from-gray-50 to-gray-100
                            dark:from-gray-800 dark:to-gray-700 dark:border-gray-600">
                        <img
                        id="detail-image"
                        src=""
                        alt="Imagen del Artículo"
                        class="absolute inset-0 w-full h-full object-contain"
                        />
                    </div>

                    <!-- Columna derecha: Nombre + Descripción -->
                    <div class="space-y-3 md:space-y-4 min-w-0">
                        <!-- Nombre -->
                        <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">Nombre</label>
                        <input
                            id="detail-name"
                            type="text"
                            class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500
                                dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200"
                        />
                        </div>

                        <!-- Descripción (Notas) -->
                        <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">Descripción</label>
                        <textarea
                            id="detail-notes"
                            rows="4"
                            class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500
                                dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200"
                            placeholder="Información útil (garantía, caducidad, estado, número de serie...)"
                        ></textarea>
                        </div>
                    </div>
                    </div>
                    <!-- Resto del formulario debajo -->

                            <!-- Ubicación -->
                            <div>
                                <label
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1"
                                >
                                    Ubicación
                                </label>

                                <div class="relative">
                                    <select
                                        id="detail-location"
                                        class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200"
                                    >
                                        <option value="">Ninguna</option>
                                    </select>
                                </div>

                                <!-- Sugerencias de ubicaciones -->
                                <div
                                    id="detail-location-list"
                                    class="hidden mt-2 border border-gray-300 rounded-lg bg-white shadow-lg dark:bg-gray-800 dark:border-gray-700 overflow-hidden"
                                >
                                    <!-- Se llena con JS -->
                                </div>

                                <p class="text-[11px] text-gray-500 dark:text-gray-400 mt-2">
                                    Ej: Casa Principal ► Cocina ► Despensa
                                </p>
                            </div>

                            <!-- Cantidad -->
                            <div>
                                <label
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1"
                                >
                                    Cantidad
                                </label>
                                <input
                                    id="detail-qty"
                                    type="number"
                                    min="1"
                                    class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200"
                                />
                            </div>

                            <!-- Categoría -->
                            <!-- Categoría -->
                            <div>
                                <label
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1"
                                >
                                    Categoría
                                </label>
                                <select
                                    id="detail-category"
                                    class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200"
                                >
                                    <!-- opciones se llenan con JS -->
                                </select>
                            </div>

                            <!-- Notas -->
                            <div>
                                <label
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1"
                                >
                                    Notas
                                </label>
                                <textarea
                                    id="detail-notes"
                                    rows="3"
                                    class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200"
                                    placeholder="Información útil (garantía, caducidad, estado, número de serie...)"
                                ></textarea>
                            </div>

                            <!-- Guardar -->
                            <div class="pt-2">
                                <button
                                    id="detail-save-btn"
                                    class="w-full py-3 font-semibold text-white bg-blue-600 rounded-lg shadow hover:bg-blue-700 transition"
                                >
                                    Guardar cambios
                                </button>
                            </div>

                            <!-- Eliminar -->
                            <div>
                                <button
                                    id="detail-delete-btn"
                                    class="w-full py-3 font-semibold border-[--danger]! text-red-600 bg-white border border-red-300 rounded-lg hover:bg-red-50 dark:bg-gray-800 dark:border-red-500 dark:text-red-400 dark:hover:bg-gray-700 transition"
                                >
                                    Eliminar Artículo
                                </button>
                            </div>
                        </div>
                    </div>
                </main>
                <!-- MODAL CERRAR SESIÓN -->
                <div
                    id="logout-modal"
                    class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 hidden"
                >
                    <div
                        class="bg-white rounded-xl shadow-lg p-6 w-80 max-w-full text-center border-2 border-red-500 dark:border-red-600"
                    >
                        <div class="mb-4">
                            <svg
                                class="mx-auto mb-2 w-12 h-12 text-red-500"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                viewBox="0 0 24 24"
                            >
                                <!-- Puerta -->
                                <rect
                                    x="4"
                                    y="3"
                                    width="16"
                                    height="18"
                                    rx="1"
                                    ry="1"
                                    stroke="currentColor"
                                    fill="none"
                                />
                                <line x1="4" y1="21" x2="20" y2="21" stroke="currentColor" />
                                <!-- Manija de la puerta -->
                                <circle cx="16" cy="12" r="1" fill="currentColor" />
                                <!-- Línea vertical de la puerta -->
                                <line x1="12" y1="3" x2="12" y2="21" stroke="currentColor" />
                                <!-- Flecha hacia afuera -->
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    d="M8 12h4m0 0l-2-2m2 2l-2 2"
                                />
                            </svg>
                            <h2 class="text-lg font-semibold mb-2">¿Cerrar sesión?</h2>
                            <p class="text-gray-600">
                                ¿Estás seguro que deseas salir de tu cuenta?
                            </p>
                        </div>
                        <div class="flex justify-center gap-4 mt-6">
                            <button
                                id="logout-confirm"
                                class="px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition"
                            >
                                Cerrar Sesión
                            </button>
                            <button
                                id="logout-cancel"
                                class="px-4 py-2 bg-gray-200 text-black rounded-lg font-semibold hover:bg-gray-300 transition dark:bg-gray-700 dark:text-black dark:hover:bg-gray-600 dark:border dark:border-gray-600"
                            >
                                Cancelar
                            </button>
                        </div>
                    </div>
                </div>
                <!-- NUEVO BOTÓN FLOTANTE PARA ALERTAS -->

                <!-- NUEVO FOOTER PARA SELECCIÓN DE ALERTAS -->
                <div
                    id="alert-selection-footer"
                    class="absolute bottom-20 left-0 right-0 z-40 hidden p-4 bg-white border-t border-gray-200 dark:bg-gray-800 dark:border-gray-700"
                >
                    <button
                        id="alert-delete-selected-btn"
                        class="w-full py-3 font-bold text-white bg-red-600 rounded-lg"
                    >
                        Eliminar Seleccionadas
                    </button>
                </div>

                <!-- BARRA DE NAVEGACIÓN INFERIOR -->
                <footer
                    class="relative z-50 flex-shrink-0 w-full bg-white border-t border-gray-200 nav-bar dark:bg-gray-800 dark:border-gray-700"
                    id="main-footer"
                >
                    <div class="flex items-center justify-around h-20">
                        <button
                            data-screen="home"
                            class="p-2 text-center text-gray-500 rounded-lg nav-button active dark:text-gray-400"
                        >
                            <svg
                                class="w-6 h-6 mx-auto"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
                                ></path>
                            </svg>
                            <span class="text-xs">Inicio</span>
                        </button>
                        <button
                            data-screen="inventory"
                            class="p-2 text-center text-gray-500 rounded-lg nav-button dark:text-gray-400"
                        >
                            <svg
                                class="w-6 h-6 mx-auto"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"
                                ></path>
                            </svg>
                            <span class="text-xs">Inventario</span>
                        </button>
                        <button
                            id="add-object-btn"
                            class="w-16 h-16 mb-8 text-white bg-blue-600 rounded-full add-button-shadow"
                        >
                            <svg
                                class="w-8 h-8 mx-auto"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M12 6v6m0 0v6m0-6h6m-6 0H6"
                                ></path>
                            </svg>
                        </button>
                        <button
                            data-screen="alerts"
                            class="p-2 text-center text-gray-500 rounded-lg nav-button dark:text-gray-400"
                        >
                            <svg
                                class="w-6 h-6 mx-auto"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
                                ></path>
                            </svg>
                            <span class="text-xs">Alertas</span>
                        </button>
                        <button
                            data-screen="profile"
                            class="p-2 text-center text-gray-500 rounded-lg nav-button dark:text-gray-400"
                        >
                            <svg
                                class="w-6 h-6 mx-auto"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                                ></path>
                            </svg>
                            <span class="text-xs">Perfil</span>
                        </button>
                    </div>
                </footer>
            </div>
        </div>

        <script>
            // ---------------------------
            // 2. DATA
            // ---------------------------

            // Lugares sugeridos (para el dropdown de ubicación)
            const knownLocations = [
                'Casa Principal ► Cocina ► Despensa',
                'Casa Principal ► Cocina ► Refrigerador',
                'Casa Principal ► Sala',
                'Casa Principal ► Garaje ► Caja Herramientas',
                'Oficina ► Escritorio ► Cajón 1',
            ]

            // Categorías disponibles (para el select)
            const knownCategories = [
                'Alimentos',
                'Documentos',
                'Herramientas',
                'Electrónica',
                'Libros',
            ]

            // Base de datos en memoria
            const objectDB = {
                taladro: {
                    id: 'taladro',
                    nombre: 'Taladro Inalámbrico',
                    img: 'img/taladro.jpg',
                    ubicacion: 'Casa Principal ► Garaje ► Caja Herramientas',
                    ubicacionId: 'alm3',
                    cantidad: 1,
                    categoria: 'Herramientas',
                    notas: 'Batería al 60%. Marca Bosch.',
                },
                pasaporte: {
                    id: 'pasaporte',
                    nombre: 'Pasaporte',
                    img: 'img/pasaporte.jpg',
                    ubicacion: 'Oficina ► Escritorio ► Cajón 1',
                    ubicacionId: 'prop3',
                    cantidad: 1,
                    categoria: 'Documentos',
                    notas: 'Vence 2029. No olvidar renovarlo 6 meses antes.',
                },
                tele: {
                    id: 'tele',
                    nombre: 'Televisión Salón',
                    img: 'img/tele.jpg',
                    ubicacion: 'Casa Principal ► Sala',
                    ubicacionId: 'prop1',
                    cantidad: 1,
                    categoria: 'Electrónica',
                    notas: '4K. Garantía hasta 2026.',
                },
                libro: {
                    id: 'libro',
                    nombre: "Libro 'El Hobbit'",
                    img: 'img/libro.jpg',
                    ubicacion: 'Librero ► Sala',
                    cantidad: 1,
                    ubicacionId: 'prop1',
                    categoria: 'Libros',
                    notas: 'Edición regalo.',
                },
                arroz: {
                    id: 'arroz',
                    nombre: 'Paquete de arroz',
                    img: 'img/arroz.jpg',
                    ubicacion: 'Casa Principal ► Cocina ► Despensa',
                    cantidad: 3,
                    ubicacionId: 'alm1',
                    categoria: 'Alimentos',
                    notas: 'Caduca en noviembre.',
                },
                leche: {
                    id: 'leche',
                    nombre: 'Leche Entera',
                    img: 'img/leche.jpg',
                    ubicacion: 'Casa Principal ► Cocina ► Refrigerador',
                    ubicacionId: 'alm1',
                    cantidad: 2,
                    categoria: 'Alimentos',
                    notas: 'Una abierta, una cerrada.',
                },
            }

            const inventoryObjects = Object.values(objectDB)

            // cuál estoy editando
            let currentObjectId = null

            // --- BASE DE DATOS (FUSIONADA) ---
            const inventoryDB = {
                propiedades: [
                    {
                        id: 'prop1',
                        nombre: 'Casa Principal',
                        icono: '🏠',
                        children: ['hab1', 'hab2', 'hab3'],
                    },
                    {
                        id: 'prop2',
                        nombre: 'Apartamento de Playa',
                        icono: '🏖️',
                        children: ['hab4'],
                    },
                    { id: 'prop3', nombre: 'Oficina', icono: '🏢', children: ['obj_laptop'] }, // Objeto directo
                ],
                habitaciones: {
                    hab1: {
                        nombre: 'Cocina',
                        parent: 'prop1',
                        children: ['alm1', 'obj1'],
                        icono: '🧑‍🍳',
                    },
                    hab2: {
                        nombre: 'Dormitorio Principal',
                        parent: 'prop1',
                        children: ['alm2', 'obj_ac'],
                        icono: '🛏️',
                    },
                    hab3: {
                        nombre: 'Garaje',
                        parent: 'prop1',
                        children: ['alm3', 'obj2'],
                        icono: '🚗',
                    },
                    hab4: { nombre: 'Salón', parent: 'prop2', children: [] },
                },
                almacenamientos: {
                    alm1: {
                        nombre: 'Despensa',
                        parent: 'hab1',
                        children: ['obj3', 'obj4', 'obj_leche'],
                        icono: '📦',
                    },
                    alm2: { nombre: 'Armario Ropa', parent: 'hab2', children: [], icono: '👗' },
                    alm3: {
                        nombre: 'Caja Herramientas',
                        parent: 'hab3',
                        children: ['obj5'],
                        icono: '🧰',
                    },
                },
                objetos: {
                    obj1: {
                        nombre: 'Televisión',
                        parent: 'hab1',
                        img: 'tele.jpg',
                        icono: '📺',
                    },
                    obj2: { nombre: 'Bicicleta', parent: 'hab3', img: 'bici.jpg', icono: '🚲' },
                    obj3: {
                        nombre: 'Latas de atún',
                        parent: 'alm1',
                        img: 'atun.jpg',
                        icono: '🥫',
                    },
                    obj4: {
                        nombre: 'Paquete de arroz',
                        parent: 'alm1',
                        img: 'arroz.jpg',
                        icono: '🍚',
                    },
                    obj5: {
                        nombre: 'Taladro Inalámbrico',
                        parent: 'alm3',
                        img: 'taladro.jpg',
                        icono: '🛠️',
                    },
                    obj6: {
                        nombre: 'Cámara de fotos',
                        parent: 'hab2',
                        img: 'camara.jpg',
                        icono: '📷',
                    },
                    obj7: {
                        nombre: 'Libro de recetas',
                        parent: 'hab1',
                        img: 'libro.jpg',
                        icono: '📖',
                    },
                    obj8: {
                        nombre: 'Jarrón decorativo',
                        parent: 'hab4',
                        img: 'jarron.jpg',
                        icono: '🏺',
                    },
                    obj_leche: {
                        nombre: 'Leche Entera',
                        parent: 'alm1',
                        img: 'leche.jpg',
                        icono: '🥛',
                    },
                    obj_ac: {
                        nombre: 'Aire Acondicionado Split',
                        parent: 'hab2',
                        img: 'aire.jpg',
                        icono: '❄️',
                    },
                    obj_laptop: {
                        nombre: 'MacBook Pro 14"',
                        parent: 'prop3',
                        img: 'laptop.jpg',
                        icono: '💻',
                    },
                },
                categorias: [
                    { id: 'cat1', nombre: 'Electrónica' },
                    { id: 'cat2', nombre: 'Documentos' },
                    { id: 'cat3', nombre: 'Herramientas' },
                ],
            }

            // --- NUEVA DB DE ALERTAS ---
            let alertsDB = [
                {
                    id: 'alert1',
                    title: 'Leche caduca mañana',
                    description: 'Revisar la leche en la nevera.',
                    priority: 'alta',
                    locationId: 'alm1',
                    objectId: 'obj_leche',
                    date: '2025-10-24',
                    repetitive: false,
                    repeatFrequency: null,
                    active: true,
                },
                {
                    id: 'alert4',
                    title: 'Pagar servicio de luz',
                    description: 'Factura de luz vence hoy.',
                    priority: 'alta',
                    locationId: 'prop1',
                    objectId: '',
                    date: '2025-10-23',
                    repetitive: false,
                    repeatFrequency: null,
                    active: true,
                }, // Ejemplo Importante
                {
                    id: 'alert2',
                    title: 'Mantenimiento aire acondicionado',
                    description: 'Llamar al técnico.',
                    priority: 'media',
                    locationId: 'hab2',
                    objectId: 'obj_ac',
                    date: '2025-10-28',
                    repetitive: true,
                    repeatFrequency: 'anual',
                    active: true,
                }, // Ejemplo Próxima (Media)
                {
                    id: 'alert3',
                    title: 'Garantía del portátil vence',
                    description: '',
                    priority: 'baja',
                    locationId: 'prop3',
                    objectId: 'obj_laptop',
                    date: '2025-12-23',
                    repetitive: false,
                    repeatFrequency: null,
                    active: true,
                }, // Ejemplo Próxima (Baja)
                {
                    id: 'alert6',
                    title: 'Comprar pienso del perro',
                    description: 'Se está acabando.',
                    priority: 'media',
                    locationId: 'alm1',
                    objectId: '',
                    date: '2025-11-01',
                    repetitive: true,
                    repeatFrequency: 'mensual',
                    active: false,
                }, // Ejemplo Desactivada
                {
                    id: 'alert5',
                    title: 'Revisión del coche',
                    description: 'Revisión de los 50,000km.',
                    priority: 'media',
                    locationId: 'hab3',
                    objectId: '',
                    date: '2025-10-15',
                    repetitive: false,
                    repeatFrequency: null,
                    active: true,
                }, // Ejemplo Pasada
                {
                    id: 'alert7',
                    title: 'Pagar tarjeta crédito',
                    description: '',
                    priority: 'alta',
                    locationId: '',
                    objectId: '',
                    date: '2025-09-30',
                    repetitive: false,
                    repeatFrequency: null,
                    active: true,
                }, // Ejemplo Pasada (Alta)
            ]
            function mostrarCambiosGuardados() {
                const savedOkModal = document.getElementById('saved-ok-modal')
                if (savedOkModal) {
                    savedOkModal.classList.remove('hidden')
                }
            }
            function mostrarEliminarExito() {
                const deletedOkModal = document.getElementById('deleted-ok-modal')
                if (deletedOkModal) {
                    deletedOkModal.classList.remove('hidden')
                }
            }
            function hide(el) {
                el.classList.add('hidden')
            }

            function show(el) {
                el.classList.remove('hidden')
            }

            function populateUbicaciones(alertLocationInput) {
                alertLocationInput.innerHTML = '<option value="">Ninguna</option>'
                inventoryDB.propiedades.forEach(prop => {
                    let optionsHTML = `<option value="${prop.id}">${prop.nombre} (Completo)</option>`
                    prop.children.forEach(childId => {
                        if (inventoryDB.habitaciones[childId]) {
                            const hab = inventoryDB.habitaciones[childId]
                            optionsHTML += `<option value="${childId}">&nbsp;&nbsp;${hab.nombre}</option>`
                            hab.children.forEach(grandChildId => {
                                if (grandChildId.startsWith('alm')) {
                                    const alm = inventoryDB.almacenamientos[grandChildId]
                                    optionsHTML += `<option value="${grandChildId}">&nbsp;&nbsp;&nbsp;&nbsp;${alm.nombre}</option>`
                                }
                            })
                        }
                    })
                    alertLocationInput.innerHTML += `<optgroup label="${prop.nombre}">${optionsHTML}</optgroup>`
                })
            }
            function addButtonSave(level, id) {
                const addButtonsContainer = document.createElement('div')
                addButtonsContainer.className = 'mt-4 space-y-3'

                const buttonConfig = {
                    propiedades: [{ text: '+ Añadir Propiedad', type: 'propiedad' }],
                    habitaciones: [
                        { text: '+ Añadir Habitación', type: 'habitacion' },
                        { text: '+ Añadir Artículo', type: 'artículo_principal' }, // Añadir objeto a propiedad
                    ],
                    contenidos: [
                        { text: '+ Añadir Contenedor', type: 'contenedor' },
                        { text: '+ Añadir Artículo', type: 'artículo_principal' }, // Añadir objeto a habitación
                    ],
                    objetos: [{ text: '+ Añadir Artículo', type: 'artículo_principal' }], // Añadir objeto a almacenamiento
                }

                if (buttonConfig[level]) {
                    buttonConfig[level].forEach(config => {
                        const addButton = document.createElement('button')
                        addButton.className =
                            'w-full py-3 font-semibold text-blue-600 border-2 border-blue-500 border-dashed rounded-lg hover:bg-blue-50 dark:hover:bg-gray-700 dark:text-blue-400 dark:border-blue-400'
                        addButton.textContent = config.text
                        addButton.addEventListener('click', () => {
                            if (config.type === 'objeto_principal') {
                                modal.dataset.parentId = id
                                addObjectBtn.dispatchEvent(new Event('click'))
                            } else {
                                const modalGenericTitle =
                                    document.getElementById('modal-generic-title')
                                const modalGenericInput =
                                    document.getElementById('modal-generic-input')
                                const modalAddGeneric = document.getElementById('modal-add-generic')
                                modalGenericTitle.textContent = config.text.replace('+ ', '')
                                modalGenericInput.placeholder = `Nombre de ${config.type}`
                                modalAddGeneric.dataset.addType = config.type
                                modalAddGeneric.dataset.parentId = id
                                modalAddGeneric.classList.remove('hidden')
                                modalAddGeneric.classList.add('flex')
                                modalGenericInput.focus()
                            }
                        })
                        addButtonsContainer.appendChild(addButton)
                    })
                    document.getElementById('inventory-content').appendChild(addButtonsContainer)
                }
            }
            // Oculta la barra de navegación y el contenido principal cuando el login simple está activo
            document.addEventListener('DOMContentLoaded', function () {
                const standaloneLogin = document.getElementById('standalone-login')
                const mainFooter = document.getElementById('main-footer')
                const appFrame = document.getElementById('app-frame')
                function toggleStandaloneLogin(show) {
                    if (standaloneLogin) standaloneLogin.classList.toggle('hidden', !show)
                    if (mainFooter) mainFooter.style.display = show ? 'none' : ''
                    if (appFrame) appFrame.style.background = show ? '' : ''
                }
                // Hook en el login para asegurar que se oculte el footer
                if (standaloneLogin) {
                    const observer = new MutationObserver(function () {
                        const isVisible = !standaloneLogin.classList.contains('hidden')
                        if (mainFooter) mainFooter.style.display = isVisible ? 'none' : ''
                    })
                    observer.observe(standaloneLogin, {
                        attributes: true,
                        attributeFilter: ['class'],
                    })
                }
            })
            // Lógica para pantalla de login simple separada
            document.addEventListener('DOMContentLoaded', function () {
                const standaloneLogin = document.getElementById('standalone-login')
                const standaloneLoginUsername = document.getElementById('standalone-login-username')
                const standaloneLoginPassword = document.getElementById('standalone-login-password')
                const standaloneLoginBtn = document.getElementById('standalone-login-btn')
                const standaloneLoginError = document.getElementById('standalone-login-error')
                const standaloneTogglePassword = document.getElementById(
                    'standalone-toggle-password'
                )
                const standaloneEyeIcon = document.getElementById('standalone-eye-icon')
                if (standaloneTogglePassword && standaloneLoginPassword) {
                    standaloneTogglePassword.addEventListener('click', function () {
                        if (standaloneLoginPassword.type === 'password') {
                            standaloneLoginPassword.type = 'text'
                            standaloneEyeIcon.classList.add('text-blue-600')
                        } else {
                            standaloneLoginPassword.type = 'password'
                            standaloneEyeIcon.classList.remove('text-blue-600')
                        }
                    })
                }
                if (standaloneLoginBtn) {
                    standaloneLoginBtn.addEventListener('click', function () {
                        try {
                            // Si ya pasamos por la simulación dejamos continuar (segunda llamada)
                            if (standaloneLoginBtn.dataset.simulated === 'true') {
                                delete standaloneLoginBtn.dataset.simulated
                            } else {
                                // Ocultar mensaje de error inmediatamente
                                if (standaloneLoginError)
                                    standaloneLoginError.classList.add('hidden')

                                // Mostrar estado "Cargando..." y animar color un rato
                                const originalText = standaloneLoginBtn.textContent
                                const originalBg = standaloneLoginBtn.style.backgroundColor || ''
                                let toggle = false
                                standaloneLoginBtn.textContent = 'Cargando...'
                                standaloneLoginBtn.disabled = true

                                const interval = setInterval(() => {
                                    standaloneLoginBtn.style.backgroundColor = toggle
                                        ? '#2563eb'
                                        : '#1e40af'
                                    toggle = !toggle
                                }, 300)

                                // Después de un tiempo re-disparamos el click para continuar con la lógica
                                setTimeout(() => {
                                    clearInterval(interval)
                                    standaloneLoginBtn.style.backgroundColor = originalBg
                                    standaloneLoginBtn.textContent = originalText
                                    standaloneLoginBtn.disabled = false
                                    // Marcamos que ya hemos simulado para que en la siguiente ejecución
                                    // no volvamos a entrar en la simulación y continue el login real
                                    standaloneLoginBtn.dataset.simulated = 'true'
                                    standaloneLoginBtn.click()
                                }, 1200)

                                // Salimos ahora para detener la ejecución inmediata del handler
                                return
                            }
                        } catch (err) {
                            console.error('Error en simulación de carga:', err)
                        }

                        const user = standaloneLoginUsername.value.trim()
                        const pass = standaloneLoginPassword.value
                        const u = user.trim().toLowerCase()
                        const p = pass.trim().toLowerCase()
                        if (u === 'carlos' && p === '12345') {
                            if (standaloneLogin) standaloneLogin.classList.add('hidden')
                            // Muestra la app principal
                            if (typeof showScreen === 'function') showScreen('home')
                            if (typeof mainScreens !== 'undefined' && mainScreens)
                                mainScreens.style.display = ''
                        } else {
                            standaloneLoginError.classList.remove('hidden')
                        }
                    })
                    standaloneLoginPassword.addEventListener('keydown', function (e) {
                        if (e.key === 'Enter') standaloneLoginBtn.click()
                    })
                }
            })
            // Modal de cerrar sesión
            document.addEventListener('DOMContentLoaded', function () {
                const logoutBtn = document.getElementById('logout-btn')
                const logoutModal = document.getElementById('logout-modal')
                const logoutConfirm = document.getElementById('logout-confirm')
                const logoutCancel = document.getElementById('logout-cancel')
                if (logoutBtn && logoutModal) {
                    logoutBtn.addEventListener('click', function (e) {
                        e.preventDefault()
                        logoutModal.classList.remove('hidden')
                    })
                    logoutCancel &&
                        logoutCancel.addEventListener('click', function () {
                            logoutModal.classList.add('hidden')
                        })
                    logoutConfirm &&
                        logoutConfirm.addEventListener('click', function () {
                            // Muestra la pantalla de login simple separada al cerrar sesión
                            const standaloneLogin = document.getElementById('standalone-login')
                            const standaloneLoginUsername = document.getElementById(
                                'standalone-login-username'
                            )
                            const standaloneLoginPassword = document.getElementById(
                                'standalone-login-password'
                            )
                            const standaloneLoginError =
                                document.getElementById('standalone-login-error')
                            if (
                                standaloneLogin &&
                                standaloneLoginUsername &&
                                standaloneLoginPassword
                            ) {
                                standaloneLogin.classList.remove('hidden')
                                standaloneLoginUsername.value = ''
                                standaloneLoginPassword.value = ''
                                if (standaloneLoginError)
                                    standaloneLoginError.classList.add('hidden')
                                standaloneLoginUsername.focus()
                            }
                            if (typeof mainScreens !== 'undefined' && mainScreens)
                                mainScreens.style.display = 'none'
                            logoutModal.classList.add('hidden')
                        })
                }
            })
            // Efecto de zoom (escala) en todas las imágenes de objetos al presionar o tocar
            document.addEventListener('DOMContentLoaded', function () {
                // Mapas de ids de imágenes a ids de objeto (puedes agregar más si hay otros listados)
                const imgToObjMap = {
                    'recent-taladro': 'obj5',
                    'recent-pasaporte': 'obj6',
                    'recent-tele': 'obj1',
                    'recent-libro': 'obj7',
                }
                Object.keys(imgToObjMap).forEach(id => {
                    const img = document.getElementById(id)
                    if (img) {
                        img.addEventListener('click', function (e) {
                            e.stopPropagation()
                            openObjectDetailModal(imgToObjMap[id])
                        })
                    }
                })

                // Efecto de escala en todas las imágenes de objetos (incluye móvil)
                function addZoomEffect(img) {
                    img.classList.add('transition-transform', 'duration-150')
                    // Para mouse
                    img.addEventListener('mousedown', function () {
                        img.classList.add('scale-105')
                    })
                    img.addEventListener('mouseup', function () {
                        img.classList.remove('scale-105')
                    })
                    img.addEventListener('mouseleave', function () {
                        img.classList.remove('scale-105')
                    })
                    // Para touch
                    img.addEventListener('touchstart', function () {
                        img.classList.add('scale-105')
                    })
                    img.addEventListener('touchend', function () {
                        img.classList.remove('scale-105')
                    })
                    img.addEventListener('touchcancel', function () {
                        img.classList.remove('scale-105')
                    })
                }
                // Inicial para imágenes ya presentes
                document.querySelectorAll('img.object-cover').forEach(addZoomEffect)
                // Si se agregan imágenes dinámicamente, puedes observar el DOM (opcional)
            })
            document.addEventListener('DOMContentLoaded', function () {
                // --- LOGIN STATE ---
                let isLoggedIn = true
                const loginScreen = document.getElementById('screen-login')
                const mainScreens = document.querySelector('main')
                const loginBtn = document.getElementById('login-btn')
                const loginUsername = document.getElementById('login-username')
                const loginPassword = document.getElementById('login-password')
                const loginError = document.getElementById('login-error')

                function showLoginScreen() {
                    isLoggedIn = false
                    loginScreen.style.display = ''
                    mainScreens.style.display = 'none'
                    loginUsername.value = ''
                    loginPassword.value = ''
                    loginError.classList.add('hidden')
                    loginUsername.focus()
                }
                function hideLoginScreen() {
                    isLoggedIn = true
                    loginScreen.style.display = 'none'
                    mainScreens.style.display = ''
                }
                if (loginBtn) {
                    loginBtn.addEventListener('click', function () {
                        const user = loginUsername.value.trim()
                        const pass = loginPassword.value
                        if (user === 'Carlos' && pass === '12345') {
                            hideLoginScreen()
                            showScreen('home')
                        } else {
                            loginError.classList.remove('hidden')
                        }
                    })
                    loginPassword.addEventListener('keydown', function (e) {
                        if (e.key === 'Enter') loginBtn.click()
                    })
                    // Ojito para mostrar/ocultar contraseña
                    const togglePassword = document.getElementById('toggle-password')
                    const eyeIcon = document.getElementById('eye-icon')
                    let passwordVisible = false
                    if (togglePassword) {
                        togglePassword.addEventListener('click', function () {
                            passwordVisible = !passwordVisible
                            loginPassword.type = passwordVisible ? 'text' : 'password'
                            // Cambiar ícono si quieres (opcional: ojo abierto/cerrado)
                            eyeIcon.innerHTML = passwordVisible
                                ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7a9.978 9.978 0 012.042-3.362M6.634 6.634A9.953 9.953 0 0112 5c4.477 0 8.268 2.943 9.542 7a9.978 9.978 0 01-4.293 5.032M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3l18 18" />'
                                : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />'
                        })
                    }
                }
                // --- ELEMENTOS DEL DOM ---
                const navButtons = document.querySelectorAll('.nav-button')
                const screens = document.querySelectorAll('main > div:not([id^="modal-"])')
                const addObjectBtn = document.getElementById('add-object-btn')
                // --- AVATAR CLICK TO PROFILE ---
                const userAvatar = document.getElementById('user-avatar')
                if (userAvatar) {
                    userAvatar.addEventListener('click', () => {
                        navigateToScreen('profile')
                    })
                }
                const closeModalBtn = document.getElementById('close-modal-btn')
                const saveObjectBtn = document.getElementById('save-object-btn')
                const modal = document.getElementById('modal-add-object')
                const modalObjectNameInput = document.getElementById('modal-object-name')
                const modalAddGeneric = document.getElementById('modal-add-generic')

                const modalGenericTitle = document.getElementById('modal-generic-title')
                const modalGenericInput = document.getElementById('modal-generic-input')
                const modalGenericCancel = document.getElementById('modal-generic-cancel')
                const modalGenericSave = document.getElementById('modal-generic-save')
                const themeToggle = document.getElementById('theme-toggle')
                const appFrame = document.getElementById('app-frame')
                const inventoryContent = document.getElementById('inventory-content')
                const inventoryNavHeader = document.getElementById('inventory-nav-header')
                const searchInput = document.getElementById('search-input')
                const homeSearchResults = document.getElementById('home-search-results')
                const homeAlertCards = document.querySelectorAll('.home-alert-card')
                const addCategoryHeaderBtn = document.getElementById('add-category-header-btn')

                // --- Nuevos elementos CRUD Perfil ---
                const navToPropertiesBtn = document.getElementById('nav-to-properties')
                const navToCategoriesBtn = document.getElementById('nav-to-categories')
                const screenProperties = document.getElementById('screen-properties')
                const propertiesList = document.getElementById('inventory-content')
                const propertiesBackBtn = document.getElementById('properties-back-btn')
                const addPropertyCrudBtn = document.getElementById('add-property-crud-btn')
                const screenCategories = document.getElementById('screen-categories')
                const categoriesList = document.getElementById('categories-list')
                const categoriesBackBtn = document.getElementById('categories-back-btn')
                const addCategoryCrudBtn = document.getElementById('add-category-crud-btn')

                // --- NUEVOS ELEMENTOS DE ALERTA ---
                const openAlertModalBtn = document.getElementById('open-alert-modal-btn')
                const modalAddAlert = document.getElementById('modal-add-alert')
                const closeAlertModalBtn = document.getElementById('close-alert-modal-btn')
                const saveAlertBtn = document.getElementById('save-alert-btn')
                const alertModalTitle = document.getElementById('alert-modal-title')
                const alertTitleInput = document.getElementById('alert-title')
                const alertDescriptionInput = document.getElementById('alert-description')
                const alertDateInput = document.getElementById('alert-date')
                const alertPriorityInput = document.getElementById('alert-priority')
                const alertLocationInput = document.getElementById('alert-location')
                const alertObjectInput = document.getElementById('alert-object')
                const alertRepetitiveCheckbox = document.getElementById('alert-repetitive')
                const alertRepeatFrequencyInput = document.getElementById('alert-repeat-frequency')
                const alertRepeatOptions = document.getElementById('alert-repeat-options')
                const alertTabs = document.querySelectorAll('.alert-tab')
                const alertLists = document.querySelectorAll('.alert-list')
                const alertEditBtn = document.getElementById('alert-edit-btn')
                const alertSelectionFooter = document.getElementById('alert-selection-footer')
                const alertDeleteSelectedBtn = document.getElementById('alert-delete-selected-btn')
                const listActuales = document.getElementById('alert-list-actuales')
                const listImportantes = document.getElementById('alert-list-importantes')
                const listProximas = document.getElementById('alert-list-proximas')
                const listDesactivadas = document.getElementById('alert-list-desactivadas')
                const listPast = document.getElementById('alert-list-past')
                const modalViewAlert = document.getElementById('modal-view-alert')
                const viewAlertTitle = document.getElementById('view-alert-title')
                const viewAlertDate = document.getElementById('view-alert-date')
                const viewAlertDescription = document.getElementById('view-alert-description')
                const viewAlertLocation = document.getElementById('view-alert-location')
                const viewAlertObject = document.getElementById('view-alert-object')
                const alertModalModify = document.getElementById('alert-modal-modify')
                const alertModalDeactivate = document.getElementById('alert-modal-deactivate')
                const alertModalReactivate = document.getElementById('alert-modal-reactivate')
                const alertModalDelete = document.getElementById('alert-modal-delete')
                const alertModalCancel = document.getElementById('alert-modal-cancel')

                modalViewAlert.addEventListener('click', () => {
                    modalViewAlert.classList.add('hidden')
                    modalViewAlert.classList.remove('flex')
                })

                // --- MODAL GLOBAL: Cambios guardados ---
                const savedOkModal = document.getElementById('saved-ok-modal')

                function showSavedOk(onClose) {
                    if (!savedOkModal) {
                        if (typeof onClose === 'function') onClose()
                        return
                    }
                    savedOkModal.classList.remove('hidden')
                    const handler = () => {
                        savedOkModal.classList.add('hidden')
                        if (typeof onClose === 'function') onClose()
                    }
                    // autocierre automático después de 1.5 segundos
                    setTimeout(() => {
                        if (!savedOkModal.classList.contains('hidden')) {
                            handler()
                        }
                    }, 1500)
                }

                // --- ESTADO GLOBAL ---
                let navStack = [] // Pila para el historial de navegación
                let currentAlertTab = 'actuales'
                let alertSelectionMode = false
                let today = new Date().toISOString().split('T')[0]

                // --- NAVEGACIÓN PRINCIPAL ---
                const activeNavButtonClass = 'active'
                const activeTextColorClass = 'text-blue-600'
                const inactiveTextColorClass = 'text-gray-500'
                const darkInactiveTextColorClass = 'dark:text-gray-400'

                function hideAllScreens() {
                    screens.forEach(s => s.classList.add('hidden'))
                }

                // --- showScreen (FUSIONADA) ---
                function showScreen(screenId) {
                    hideAllScreens()
                    const screenToShow = document.getElementById(`screen-${screenId}`)
                    if (screenToShow) {
                        screenToShow.classList.remove('hidden')
                    }

                    // Lógica específica de pantalla
                    if (screenId === 'alerts') {
                        renderAlertsScreen()
                        openAlertModalBtn.classList.remove('hidden')
                        // Mostrar/ocultar footer de selección solo si estamos en 'past' y modo edición
                        alertSelectionFooter.classList.toggle(
                            'hidden',
                            !(alertSelectionMode && currentAlertTab === 'past')
                        )
                    } else {
                        openAlertModalBtn.classList.add('hidden')
                        alertSelectionFooter.classList.add('hidden')
                        // Si salimos de la pantalla de alertas, cancelamos el modo edición
                        if (alertSelectionMode) {
                            toggleAlertSelectionMode(false) // Forzar salida del modo edición
                        }
                    }
                }

                function navigateToScreen(screenId) {
                    showScreen(screenId)
                    navButtons.forEach(btn => {
                        btn.classList.remove(activeTextColorClass, activeNavButtonClass)
                        btn.classList.add(inactiveTextColorClass, darkInactiveTextColorClass)
                    })
                    const buttonToActivate = document.querySelector(
                        `.nav-button[data-screen="${screenId}"]`
                    )
                    if (buttonToActivate) {
                        buttonToActivate.classList.add(activeTextColorClass, activeNavButtonClass)
                        buttonToActivate.classList.remove(
                            inactiveTextColorClass,
                            darkInactiveTextColorClass
                        )
                    }
                }

                navButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const screenId = button.dataset.screen

                        // Si es el botón de home y hay un input de búsqueda activo, cerrarlo
                        if (screenId === 'home') {
                            const searchInput = document.getElementById('search-input-active')
                            if (searchInput) {
                                searchInput.blur() // Quita el foco del input
                            }
                        }

                        navigateToScreen(screenId)
                    })
                })

                // --- NAVEGACIÓN DESDE ALERTAS HOME ---
                homeAlertCards.forEach(card => {
                    card.addEventListener('click', () => {
                        navigateToScreen('alerts')
                    })
                })

                // --- MODALES (Genérico y Objeto) ---
                addObjectBtn.addEventListener('click', e => {
                    modal.classList.remove('hidden')
                    modal.classList.add('flex')
                    const selectUbicacion = document.getElementById('location-object')
                    populateUbicaciones(selectUbicacion)
                })

                closeModalBtn.addEventListener('click', () => {
                    modal.classList.add('hidden')
                    modal.classList.remove('flex')
                })

                function openAddCategoryModal() {
                    modalGenericTitle.textContent = 'Añadir Nueva Categoría'
                    modalGenericInput.placeholder = 'Nombre de la categoría'
                    modalAddGeneric.dataset.addType = 'categoria'
                    modalAddGeneric.dataset.parentId = null
                    modalAddGeneric.classList.remove('hidden')
                    modalAddGeneric.classList.add('flex')
                    modalGenericInput.focus()
                }

                addCategoryHeaderBtn.addEventListener('click', openAddCategoryModal)

                function hideGenericModal() {
                    modalAddGeneric.classList.add('hidden')
                    modalAddGeneric.classList.remove('flex')
                    modalGenericInput.value = ''
                    delete modalAddGeneric.dataset.editId
                    delete modalAddGeneric.dataset.addType
                    delete modalAddGeneric.dataset.parentId
                }
                modalGenericCancel.addEventListener('click', hideGenericModal)

                // --- TEMA OSCURO ---
                themeToggle.addEventListener('change', () => {
                    appFrame.classList.toggle('dark')
                })

                // --- getFullPath (VERSIÓN MEJORADA DEL USUARIO) ---
                function getFullPath(type, id) {
                    let path = []
                    let currentId = id
                    let currentType = type
                    let loops = 0 // Safety break

                    while (currentId && loops < 10) {
                        loops++
                        let item
                        if (currentType === 'propiedades') {
                            item = inventoryDB.propiedades.find(p => p.id === currentId)
                            if (item) path.unshift(item.nombre)
                            currentId = null
                        } else if (currentType === 'habitaciones') {
                            item = inventoryDB.habitaciones[currentId]
                            if (item) {
                                path.unshift(item.nombre)
                                currentId = item.parent
                                currentType = 'propiedades'
                            } else {
                                currentId = null
                            }
                        } else if (currentType === 'almacenamientos') {
                            item = inventoryDB.almacenamientos[currentId]
                            if (item) {
                                path.unshift(item.nombre)
                                currentId = item.parent
                                currentType = 'habitaciones'
                            } else {
                                currentId = null
                            }
                        } else if (currentType === 'objetos') {
                            item = inventoryDB.objetos[currentId]
                            if (item) {
                                currentId = item.parent
                                if (inventoryDB.almacenamientos[currentId])
                                    currentType = 'almacenamientos'
                                else if (inventoryDB.habitaciones[currentId])
                                    currentType = 'habitaciones'
                                else if (inventoryDB.propiedades.find(p => p.id === currentId))
                                    currentType = 'propiedades'
                                else currentId = null
                            } else {
                                currentId = null
                            }
                        } else {
                            currentId = null
                        }
                    }
                    return path.join(' ► ')
                }

                // --- modalGenericSave (NUESTRA VERSIÓN CON CRUD) ---
                modalGenericSave.addEventListener('click', () => {
                    const newItemName = modalGenericInput.value
                    const addType = modalAddGeneric.dataset.addType
                    const parentId = modalAddGeneric.dataset.parentId

                    if (newItemName === undefined) {
                        console.error('Error: newItemName no está definido.')
                        return
                    }
                    if (newItemName && newItemName.trim() === '') {
                        modalGenericInput.classList.add('border-red-500', 'ring-red-500')
                        setTimeout(
                            () =>
                                modalGenericInput.classList.remove(
                                    'border-red-500',
                                    'ring-red-500'
                                ),
                            2000
                        )
                        return
                    }

                    // if (newItemName && newItemName.trim() !== '') {
                    const trimmedName = newItemName.trim()
                    const newId = `${addType.substring(0, 3)}${Date.now()}`
                    switch (addType) {
                        case 'propiedad':
                            console.log('Agregando nueva categoría:', trimmedName)
                            inventoryDB.propiedades.push({
                                id: newId,
                                nombre: trimmedName,
                                icono: '🏠',
                                children: [],
                            })
                            hideGenericModal()
                            // Siempre actualizar la lista si estamos en la pantalla de propiedades
                            if (!screenProperties.classList.contains('hidden')) {
                                console.log('Actualizando lista de propiedades...')
                                renderPropertiesCRUD()
                            } else {
                                console.log('No estamos en la pantalla de propiedades')
                            }
                            // Forzar actualización adicional por si acaso
                            setTimeout(() => {
                                if (!screenProperties.classList.contains('hidden')) {
                                    renderPropertiesCRUD()
                                }
                            }, 100)
                            // if (!screenInventory.classList.contains('hidden')) {
                            //     renderInventory('propiedades')
                            // }
                            // Confirmación visual
                            showSavedOk()
                            mostrarCambiosGuardados()
                            renderInventory('propiedades')
                            return
                        case 'propiedad_edit':
                            const propToEdit = inventoryDB.propiedades.find(
                                p => p.id === modalAddGeneric.dataset.editId
                            )
                            if (propToEdit) propToEdit.nombre = trimmedName
                            renderPropertiesCRUD()
                            showSavedOk()
                            break
                        case 'habitacion':
                            inventoryDB.habitaciones[newId] = {
                                nombre: trimmedName,
                                parent: parentId,
                                children: [],
                            }
                            inventoryDB.propiedades
                                .find(p => p.id === parentId)
                                .children.push(newId)
                            renderInventory('habitaciones', parentId)
                            showSavedOk()
                            break
                        case 'almacenamiento':
                            inventoryDB.almacenamientos[newId] = {
                                nombre: trimmedName,
                                parent: parentId,
                                children: [],
                            }
                            inventoryDB.habitaciones[parentId].children.push(newId)
                            renderInventory('contenidos', parentId)
                            showSavedOk()
                            break
                        case 'categoria':
                            const newCatId = `cat${Date.now()}`
                            inventoryDB.categorias.push({ id: newCatId, nombre: trimmedName })
                            renderHomeCategories()
                            if (!screenCategories.classList.contains('hidden')) {
                                renderCategoriesCRUD()
                            }
                            showSavedOk()
                            break
                        case 'categoria_edit':
                            const catToEdit = inventoryDB.categorias.find(
                                c => c.id === modalAddGeneric.dataset.editId
                            )
                            if (catToEdit) catToEdit.nombre = trimmedName
                            renderCategoriesCRUD()
                            renderHomeCategories()
                            showSavedOk()
                            break
                    }
                    // }
                    hideGenericModal()
                })

                // --- saveObjectBtn (NUESTRA VERSIÓN) ---
                saveObjectBtn.addEventListener('click', () => {
                    const objectName = modalObjectNameInput.value
                    const parentId = modal.dataset.parentId // Esto se debe setear al abrir el modal desde inventario

                    if (objectName && objectName.trim() !== '' && parentId) {
                        const trimmedName = objectName.trim()
                        const newId = `obj${Date.now()}`

                        inventoryDB.objetos[newId] = { nombre: trimmedName, parent: parentId }

                        if (inventoryDB.almacenamientos[parentId]) {
                            inventoryDB.almacenamientos[parentId].children.push(newId)
                        } else if (inventoryDB.habitaciones[parentId]) {
                            inventoryDB.habitaciones[parentId].children.push(newId)
                        }

                        modal.classList.add('hidden')
                        modal.classList.remove('flex')
                        modalObjectNameInput.value = ''

                        const currentState = navStack[navStack.length - 1] || {
                            level: 'propiedades',
                            id: null,
                        }
                        renderInventory(currentState.level, currentState.id)
                        // Confirmación visual
                        showSavedOk()
                    } else if (!parentId) {
                        console.error(
                            'Error: parentId no está definido en el modal. El modal debe ser abierto desde un contexto.'
                        )
                        modalObjectNameInput.classList.add('border-red-500', 'ring-red-500')
                    } else {
                        modalObjectNameInput.classList.add('border-red-500', 'ring-red-500')
                        setTimeout(
                            () =>
                                modalObjectNameInput.classList.remove(
                                    'border-red-500',
                                    'ring-red-500'
                                ),
                            2000
                        )
                    }
                })

                // --- LÓGICA DE INVENTARIO (NUESTRA VERSIÓN) ---
                function renderInventory(level, id) {
                    console.log('Renderizando inventario en nivel:', level, 'con id:', id)
                    inventoryContent.innerHTML = ''
                    let items = []
                    let title = 'Inventario'

                    if (level === 'propiedades') {
                        items = inventoryDB.propiedades.map(p => ({ ...p, tipo: 'propiedad' }))
                        title = 'Propiedades'
                    } else if (level === 'habitaciones') {
                        const prop = inventoryDB.propiedades.find(p => p.id === id)
                        if (!prop) return
                        items = prop.children
                            .map(childId => {
                                if (inventoryDB.habitaciones[childId])
                                    return {
                                        ...inventoryDB.habitaciones[childId],
                                        id: childId,
                                        tipo: 'habitacion',
                                    }
                                if (inventoryDB.objetos[childId])
                                    return {
                                        ...inventoryDB.objetos[childId],
                                        id: childId,
                                        tipo: 'objeto',
                                    }
                                return null
                            })
                            .filter(Boolean) // Filtrar nulos
                        title = prop.nombre
                    } else if (level === 'contenidos') {
                        const hab = inventoryDB.habitaciones[id]
                        if (!hab) return
                        const contenedores = hab.children
                            .filter(childId => childId.startsWith('alm'))
                            .map(childId => ({
                                ...inventoryDB.almacenamientos[childId],
                                id: childId,
                                tipo: 'contenedor',
                            }))
                        const objetosSueltos = hab.children
                            .filter(childId => childId.startsWith('obj'))
                            .map(childId => ({
                                ...inventoryDB.objetos[childId],
                                id: childId,
                                tipo: 'objeto',
                            }))
                        items = [...contenedores, ...objetosSueltos]
                        title = hab.nombre
                    } else if (level === 'objetos') {
                        const alm = inventoryDB.almacenamientos[id]
                        if (!alm) return
                        items = alm.children.map(childId => ({
                            ...inventoryDB.objetos[childId],
                            id: childId,
                            tipo: 'objeto',
                        }))
                        title = alm.nombre
                    }

                    let backButtonHTML = ''
                    if (navStack.length > 0) {
                        backButtonHTML = `<button id="inventory-back-btn" class="p-2 mr-3 -ml-2 text-gray-600 rounded-full hover:bg-gray-200 dark:text-gray-300 dark:hover:bg-gray-700"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>`
                    }
                    inventoryNavHeader.innerHTML = `${backButtonHTML}<h1 class="text-2xl font-bold text-gray-800 truncate dark:text-white">${title}</h1>`

                    if (items.length > 0) {
                        items.forEach(item => {
                            const div = document.createElement('div')
                            div.className =
                                'flex items-center justify-between p-4 bg-white border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 card dark:bg-gray-700 dark:border-gray-600'
                            div.dataset.id = item.id
                            let nextLevel = '',
                                icon = item.icono || '📁'
                            if (item.tipo === 'propiedad') {
                                nextLevel = 'habitaciones'
                                icon = item.icono || '🏠'
                            }
                            if (item.tipo === 'habitacion') {
                                nextLevel = 'contenidos'
                                // Iconos personalizados para habitaciones específicas
                                if (item.icono) {
                                    icon = item.icono
                                } else {
                                    icon = '🚪'
                                }
                            }
                            if (item.tipo === 'contenedor') {
                                nextLevel = 'objetos'
                                icon = item.icono || '📦'
                            }
                            if (item.tipo === 'objeto') {
                                icon = item.icono || '🔩'
                            }
                            if (nextLevel) div.dataset.nextLevel = nextLevel

                            div.innerHTML = `<div class="flex items-center"><span class="mr-4 text-2xl">${icon}</span><span class="font-medium text-gray-800 dark:text-gray-100">${
                                item.nombre
                            }</span></div>${
                                item.tipo !== 'objeto'
                                    ? '<svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>'
                                    : ''
                            }`
                            inventoryContent.appendChild(div)
                        })
                    } else {
                        inventoryContent.innerHTML = `<p class="py-10 text-center text-gray-500 dark:text-gray-400">No hay elementos aquí.</p>`
                    }
                    addButtonSave(level, id)

                    inventoryContent.querySelectorAll('div[data-id]').forEach(el => {
                        el.addEventListener('click', () => {
                            if (el.dataset.nextLevel) {
                                navStack.push({ level, id })
                                renderInventory(el.dataset.nextLevel, el.dataset.id)
                            }
                        })
                    })

                    if (document.getElementById('inventory-back-btn')) {
                        document
                            .getElementById('inventory-back-btn')
                            .addEventListener('click', () => {
                                const lastState = navStack.pop()
                                if (lastState) renderInventory(lastState.level, lastState.id)
                            })
                    }
                    // addButtonSave()
                }

                document
                    .querySelector('[data-screen="inventory"]')
                    .addEventListener('click', () => {
                        navStack = []
                        renderInventory('propiedades')
                    })

                // --- LÓGICA DE BÚSQUEDA (NUESTRA VERSIÓN) ---
                function performSearchHome() {
                    const term = searchInput.value.trim().toLowerCase()
                    if (term.length < 1) {
                        homeSearchResults.innerHTML = ''
                        document.querySelector(
                            '#screen-home .grid.grid-cols-2'
                        ).parentElement.style.display = ''
                        return
                    }
                    // Filtrar objetos por coincidencia
                    const results = Object.keys(inventoryDB.objetos).filter(objId => {
                        const obj = inventoryDB.objetos[objId]
                        return obj.nombre && obj.nombre.toLowerCase().includes(term)
                    })
                    if (results.length > 0) {
                        homeSearchResults.innerHTML = ''
                        results.forEach(objId => {
                            const obj = inventoryDB.objetos[objId]
                            const path = getFullPath('objetos', objId)
                            const div = document.createElement('div')
                            div.className =
                                'flex items-center p-3 bg-white rounded-lg shadow-sm cursor-pointer hover:bg-blue-50 dark:bg-gray-800 dark:hover:bg-gray-700 mb-2'
                            div.innerHTML = `
                            <img src="img/${obj.img || 'placeholder.jpg'}" alt="${
                                obj.nombre
                            }" class="w-14 h-14 object-cover rounded-lg mr-3 border border-gray-200 dark:border-gray-700">
                            <div>
                                <div class="font-semibold text-gray-800 dark:text-white">${
                                    obj.nombre
                                }</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">${path}</div>
                            </div>
                        `
                            div.addEventListener('click', () => {
                                openObjectDetailModal(objId)
                            })
                            homeSearchResults.appendChild(div)
                        })
                        // Ocultar la sección de añadidos recientemente
                        document.querySelector(
                            '#screen-home .grid.grid-cols-2'
                        ).parentElement.style.display = 'none'
                    } else {
                        homeSearchResults.innerHTML =
                            '<p class="py-6 text-center text-gray-500 dark:text-gray-400">No se encontraron Artículos.</p>'
                        document.querySelector(
                            '#screen-home .grid.grid-cols-2'
                        ).parentElement.style.display = 'none'
                    }
                }

                // Modal solo visualización de objeto
                function openObjectDetailModal(objId) {
                    const obj = inventoryDB.objetos[objId]
                    if (!obj) return
                    // Mostrar modal
                    modal.classList.remove('hidden')
                    modal.classList.add('flex')
                    // Cambiar título
                    modal.querySelector('h2').textContent = 'Detalle del Artículo'

                    // Rellenar campos principales
                    modalObjectNameInput.value = obj.nombre || ''

                    // Buscar y rellenar descripción
                    const descInput = modal.querySelector('textarea')
                    if (descInput) descInput.value = obj.descripcion || ''

                    // Rellenar categoría
                    const catSelect = modal.querySelectorAll('select')[0]
                    if (catSelect) {
                        let found = false
                        for (let i = 0; i < catSelect.options.length; i++) {
                            if (catSelect.options[i].text === obj.categoria) {
                                catSelect.selectedIndex = i
                                found = true
                                break
                            }
                        }
                        if (!found) catSelect.selectedIndex = 0
                    }

                    // Rellenar cantidad
                    const cantidadInput = modal.querySelector('input[type="number"]')
                    if (cantidadInput) cantidadInput.value = obj.cantidad || ''

                    // Rellenar unidad
                    const unidadSelect = modal.querySelectorAll('select')[1]
                    if (unidadSelect) {
                        let found = false
                        for (let i = 0; i < unidadSelect.options.length; i++) {
                            if (unidadSelect.options[i].text === obj.unidad) {
                                unidadSelect.selectedIndex = i
                                found = true
                                break
                            }
                        }
                        if (!found) unidadSelect.selectedIndex = 0
                    }

                    // Rellenar ubicación
                    const ubicacionSelect = modal.querySelectorAll('select')[2]
                    if (ubicacionSelect) {
                        // Buscar path completo
                        let ubicacion = ''
                        if (obj.parent) {
                            // Buscar el path del objeto
                            ubicacion = getFullPath('objetos', objId)
                        }
                        let found = false
                        for (let i = 0; i < ubicacionSelect.options.length; i++) {
                            if (ubicacionSelect.options[i].text === ubicacion) {
                                ubicacionSelect.selectedIndex = i
                                found = true
                                break
                            }
                        }
                        if (!found) ubicacionSelect.selectedIndex = 0
                    }

                    // Mostrar imagen si existe
                    const imgDiv = modal.querySelector(
                        '.flex.items-center.justify-center.w-full.h-32'
                    )
                    if (imgDiv) {
                        imgDiv.innerHTML = obj.img
                            ? `<img src="img/${obj.img}" alt="${obj.nombre}" class="object-contain h-full w-full">`
                            : `<div class="text-center text-gray-500"><svg class="w-8 h-8 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg><p>Sin imagen</p></div>`
                    }

                    // Deshabilitar todos los inputs y selects
                    modal.querySelectorAll('input, textarea, select').forEach(el => {
                        el.disabled = true
                    })
                    // Ocultar botón guardar
                    saveObjectBtn.style.display = 'none'
                    // Al cerrar, restaurar todo
                    function restoreModal() {
                        modal.querySelector('h2').textContent = 'Añadir Nuevo Objeto'
                        if (imgDiv)
                            imgDiv.innerHTML = `<div class="text-center text-gray-500"><svg class="w-8 h-8 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg><p>Tocar para añadir foto</p></div>`
                        modal.querySelectorAll('input, textarea, select').forEach(el => {
                            el.disabled = false
                        })
                        saveObjectBtn.style.display = ''
                    }
                    closeModalBtn.addEventListener('click', restoreModal, { once: true })
                }
                searchInput.addEventListener('input', performSearchHome)

                // --- RENDER CATEGORÍAS HOME (NUESTRA VERSIÓN) ---
                // --- RENDER AÑADIDOS RECIENTEMENTE ---
                function renderRecentlyAdded() {
                    const container = document.getElementById('home-recent-list')
                    if (!container) return
                    container.innerHTML = ''
                    // Tomar los 4 objetos más recientes (por id de creación, o por orden en la lista)
                    const recentObjs = Object.entries(inventoryDB.objetos)
                        .slice(-4)
                        .map(([id, obj]) => ({ id, ...obj }))
                        .reverse()
                    recentObjs.forEach(obj => {
                        const div = document.createElement('div')
                        div.className =
                            'inline-block mr-3 bg-white rounded-lg shadow cursor-pointer hover:bg-blue-50 dark:bg-gray-800 dark:hover:bg-gray-700 p-1'
                        div.style.transition = 'background 0.15s'
                        div.innerHTML = `<img src="img/${obj.img || 'default.jpg'}" alt="${
                            obj.nombre
                        }" class="w-20 h-20 rounded-lg object-cover mb-1" data-obj-id="${
                            obj.id
                        }"><div class="text-xs text-center mt-1 font-semibold text-gray-800 dark:text-white" data-obj-id="${
                            obj.id
                        }">${obj.nombre}</div>`
                        // Hacer clickeable toda la tarjeta (div), imagen y título
                        div.addEventListener('click', () => {
                            navigateToObjectInInventory(obj.id)
                        })
                        div.querySelectorAll('[data-obj-id]').forEach(el => {
                            el.style.cursor = 'pointer'
                            el.addEventListener('click', e => {
                                e.stopPropagation()
                                navigateToObjectInInventory(obj.id)
                            })
                        })
                        container.appendChild(div)
                    })
                    // Navegar y resaltar objeto en inventario desde cualquier parte
                    function navigateToObjectInInventory(objId) {
                        // Buscar la ruta hasta el objeto
                        // 1. Buscar el parent (puede ser almacenamiento, habitación o propiedad)
                        const obj = inventoryDB.objetos[objId]
                        if (!obj) return
                        let parentId = obj.parent
                        let parentType = null
                        // Determinar tipo de parent
                        if (inventoryDB.almacenamientos[parentId]) {
                            parentType = 'almacenamientos'
                        } else if (inventoryDB.habitaciones[parentId]) {
                            parentType = 'habitaciones'
                        } else if (inventoryDB.propiedades.find(p => p.id === parentId)) {
                            parentType = 'propiedades'
                        }
                        // Navegar la pila según el tipo
                        navStack = []
                        if (parentType === 'almacenamientos') {
                            // Buscar la habitación y propiedad
                            const alm = inventoryDB.almacenamientos[parentId]
                            const habId = alm.parent
                            const hab = inventoryDB.habitaciones[habId]
                            const propId = hab.parent
                            navStack.push({ level: 'propiedades', id: null })
                            navStack.push({ level: 'habitaciones', id: propId })
                            navStack.push({ level: 'contenidos', id: habId })
                            renderInventory('Artículos', parentId)
                        } else if (parentType === 'habitaciones') {
                            // Buscar la propiedad
                            const hab = inventoryDB.habitaciones[parentId]
                            const propId = hab.parent
                            navStack.push({ level: 'propiedades', id: null })
                            navStack.push({ level: 'habitaciones', id: propId })
                            renderInventory('contenidos', parentId)
                        } else if (parentType === 'propiedades') {
                            navStack.push({ level: 'propiedades', id: null })
                            renderInventory('habitaciones', parentId)
                        }
                        // Mostrar pantalla de inventario
                        showScreen('inventory')
                        // Resaltar el objeto
                        setTimeout(() => {
                            const el = document.querySelector(`[data-id="${objId}"]`)
                            if (el) {
                                el.classList.add('ring-2', 'ring-blue-500', 'ring-offset-2')
                                setTimeout(() => {
                                    el.classList.remove('ring-2', 'ring-blue-500', 'ring-offset-2')
                                }, 1800)
                                el.scrollIntoView({ behavior: 'smooth', block: 'center' })
                            }
                        }, 120)
                    }
                }
                function renderHomeCategories() {
                    const container = document.getElementById('home-categories-list')
                    container.innerHTML = ''
                    if (inventoryDB.categorias.length === 0) {
                        container.innerHTML = `<p class="py-10 text-center text-gray-500 dark:text-gray-400 col-span-full">No tienes categorías.</p>`
                        return
                    }
                    // Mostrar como grid de 2 columnas, estilo bonito
                    const grid = document.createElement('div')
                    grid.className = 'grid grid-cols-2 gap-2'
                    inventoryDB.categorias.forEach(cat => {
                        const div = document.createElement('div')
                        div.className = 'flex justify-center'
                        const pill = document.createElement('span')
                        pill.className = 'category-pill'
                        pill.textContent = cat.nombre
                        div.appendChild(pill)
                        grid.appendChild(div)
                    })
                    container.appendChild(grid)
                    grid.className = 'grid grid-cols-2 gap-2'
                    inventoryDB.categorias.forEach(cat => {
                        const div = document.createElement('div')
                        div.textContent = cat.nombre
                        div.className =
                            'px-3 py-2 rounded-full border border-blue-300 bg-white text-gray-800 dark:bg-gray-800 dark:text-gray-200 dark:border-blue-700 shadow-sm font-medium text-sm text-center'
                        grid.appendChild(div)
                    })
                    container.appendChild(grid)
                }

                // --- NAVEGACIÓN Y CRUD DE PERFIL (NUESTRA VERSIÓN) ---
                // --- CERRAR SESIÓN ---
                const logoutBtn = document.querySelector('.logout-btn')
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', function () {
                        showLoginScreen()
                    })
                }
                navToPropertiesBtn.addEventListener('click', () => {
                    renderPropertiesCRUD()
                    showScreen('properties')
                })
                propertiesBackBtn.addEventListener('click', () => showScreen('profile'))
                addPropertyCrudBtn.addEventListener('click', () => {
                    modalGenericTitle.textContent = 'Añadir Nueva Propiedad'
                    modalGenericInput.placeholder = 'Nombre de la propiedad'
                    modalAddGeneric.dataset.addType = 'propiedad'
                    modalAddGeneric.classList.remove('hidden')
                    modalAddGeneric.classList.add('flex')
                    modalGenericInput.focus()
                })

                function renderPropertiesCRUD() {
                    console.log(
                        'Renderizando propiedades para CRUD',
                        inventoryDB.propiedades,
                        propertiesList
                    )
                    propertiesList.innerHTML = ''
                    if (inventoryDB.propiedades.length === 0) {
                        propertiesList.innerHTML = `<p class="py-10 text-center text-gray-500">No tienes propiedades.</p>`
                        return
                    }
                    inventoryDB.propiedades.forEach(prop => {
                        const div = document.createElement('div')
                        div.className =
                            'flex items-center justify-between p-4 bg-white border border-gray-200 rounded-lg card'
                        div.innerHTML = `
                        <div class="flex items-center clickable-prop" style="cursor:pointer;">
                            <span class="mr-4 text-2xl">${prop.icono || '🏠'}</span>
                            <span class="font-medium text-gray-800 dark:text-gray-100">${
                                prop.nombre
                            }</span>
                        </div>
                        <div class="flex space-x-2">
                            <button class="icon-button edit" data-id="${prop.id}" data-name="${
                            prop.nombre
                        }">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.536L16.732 3.732z"></path></svg>
                            </button>
                            <button class="icon-button delete" data-id="${prop.id}">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            </button>
                        </div>
                    `
                        console.log('Añadiendo propiedad al listado:', div)
                        propertiesList.appendChild(div)

                        // Permitir editar tocando el nombre o icono
                        const clickable = div.querySelector('.clickable-prop')
                        if (clickable) {
                            clickable.addEventListener('click', () => {
                                modalGenericTitle.textContent = 'Editar Propiedad'
                                modalGenericInput.value = prop.nombre
                                modalAddGeneric.dataset.addType = 'propiedad_edit'
                                modalAddGeneric.dataset.editId = prop.id
                                modalAddGeneric.classList.remove('hidden')
                                modalAddGeneric.classList.add('flex')
                                modalGenericInput.focus()
                            })
                        }
                    })
                    console.log(propertiesList)

                    propertiesList.querySelectorAll('.edit').forEach(btn => {
                        btn.addEventListener('click', () => {
                            modalGenericTitle.textContent = 'Editar Propiedad'
                            modalGenericInput.value = btn.dataset.name
                            modalAddGeneric.dataset.addType = 'propiedad_edit'
                            modalAddGeneric.dataset.editId = btn.dataset.id
                            modalAddGeneric.classList.remove('hidden')
                            modalAddGeneric.classList.add('flex')
                            modalGenericInput.focus()
                        })
                    })

                    propertiesList.querySelectorAll('.delete').forEach(btn => {
                        btn.addEventListener('click', () => {
                            const propId = btn.dataset.id
                            const index = inventoryDB.propiedades.findIndex(p => p.id === propId)
                            if (index > -1) {
                                inventoryDB.propiedades.splice(index, 1)
                                renderPropertiesCRUD()
                            }
                        })
                    })
                }

                navToCategoriesBtn.addEventListener('click', () => {
                    renderCategoriesCRUD()
                    showScreen('categories')
                })
                categoriesBackBtn.addEventListener('click', () => showScreen('profile'))
                addCategoryCrudBtn.addEventListener('click', openAddCategoryModal)

                function renderCategoriesCRUD() {
                    categoriesList.innerHTML = ''
                    if (inventoryDB.categorias.length === 0) {
                        categoriesList.innerHTML = `<p class="py-10 text-center text-gray-500">No tienes categorías.</p>`
                        return
                    }
                    inventoryDB.categorias.forEach(cat => {
                        const div = document.createElement('div')
                        div.className =
                            'flex items-center justify-between p-4 bg-white border border-gray-200 rounded-lg card'
                        div.innerHTML = `
                        <span class="font-medium text-gray-800 dark:text-gray-100 clickable-cat" style="cursor:pointer;">${cat.nombre}</span>
                        <div class="flex space-x-2">
                            <button class="icon-button edit" data-id="${cat.id}" data-name="${cat.nombre}">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.536L16.732 3.732z"></path></svg>
                            </button>
                            <button class="icon-button delete" data-id="${cat.id}">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            </button>
                        </div>
                    `
                        categoriesList.appendChild(div)

                        // Permitir editar tocando el nombre
                        const clickable = div.querySelector('.clickable-cat')
                        if (clickable) {
                            clickable.addEventListener('click', () => {
                                modalGenericTitle.textContent = 'Editar Categoría'
                                modalGenericInput.value = cat.nombre
                                modalAddGeneric.dataset.addType = 'categoria_edit'
                                modalAddGeneric.dataset.editId = cat.id
                                modalAddGeneric.classList.remove('hidden')
                                modalAddGeneric.classList.add('flex')
                                modalGenericInput.focus()
                            })
                        }
                    })

                    categoriesList.querySelectorAll('.edit').forEach(btn => {
                        btn.addEventListener('click', () => {
                            modalGenericTitle.textContent = 'Editar Categoría'
                            modalGenericInput.value = btn.dataset.name
                            modalAddGeneric.dataset.addType = 'categoria_edit'
                            modalAddGeneric.dataset.editId = btn.dataset.id
                            modalAddGeneric.classList.remove('hidden')
                            modalAddGeneric.classList.add('flex')
                            modalGenericInput.focus()
                        })
                    })

                    categoriesList.querySelectorAll('.delete').forEach(btn => {
                        btn.addEventListener('click', () => {
                            const catId = btn.dataset.id
                            const index = inventoryDB.categorias.findIndex(c => c.id === catId)
                            if (index > -1) {
                                inventoryDB.categorias.splice(index, 1)
                                renderCategoriesCRUD()
                                renderHomeCategories()
                            }
                        })
                    })
                }

                // --- NUEVAS FUNCIONES DE ALERTA ---
                function getPriorityClasses(alert) {
                    if (!alert.active) {
                        return {
                            // Estilo Desactivado
                            border: 'border-l-4 border-gray-400 dark:border-gray-600',
                            bg: 'bg-gray-100/60 dark:bg-gray-800/50',
                            text: 'text-gray-600 dark:text-gray-400',
                            iconBg: 'bg-gray-200 dark:bg-gray-700',
                            iconText: 'text-gray-500 dark:text-gray-400',
                        }
                    }
                    switch (alert.priority) {
                        case 'alta':
                            return {
                                border: 'border-l-4 border-red-500 dark:border-red-400',
                                bg: 'bg-red-100/60 dark:bg-red-900/50',
                                text: 'text-red-800 dark:text-red-200',
                                iconBg: 'bg-red-100 dark:bg-red-800',
                                iconText: 'text-red-500 dark:text-red-300',
                            }
                        case 'media':
                            return {
                                border: 'border-l-4 border-yellow-500 dark:border-yellow-400',
                                bg: 'bg-yellow-100/60 dark:bg-yellow-900/50',
                                text: 'text-yellow-800 dark:text-yellow-200',
                                iconBg: 'bg-yellow-100 dark:bg-yellow-800',
                                iconText: 'text-yellow-500 dark:text-yellow-300',
                            }
                        case 'baja':
                        default:
                            return {
                                border: 'border-l-4 border-blue-500 dark:border-blue-400',
                                bg: 'bg-blue-100/60 dark:bg-blue-900/50',
                                text: 'text-blue-800 dark:text-blue-200',
                                iconBg: 'bg-blue-100 dark:bg-blue-800',
                                iconText: 'text-blue-500 dark:text-blue-300',
                            }
                    }
                }

                function formatAlertDate(dateString) {
                    if (!dateString) return 'Sin fecha'
                    const parts = dateString.split('-')
                    if (parts.length !== 3) return 'Fecha inválida'
                    const date = new Date(Date.UTC(parts[0], parts[1] - 1, parts[2]))
                    if (isNaN(date)) return 'Fecha inválida'

                    const todayDate = new Date()
                    todayDate.setUTCHours(0, 0, 0, 0)
                    const tomorrowDate = new Date(todayDate)
                    tomorrowDate.setUTCDate(tomorrowDate.getUTCDate() + 1)

                    if (date.getTime() === todayDate.getTime()) return 'Hoy'
                    if (date.getTime() === tomorrowDate.getTime()) return 'Mañana'

                    const diffTime = date - todayDate
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24))

                    if (diffDays < 0) {
                        return `Hace ${Math.abs(diffDays)} día${Math.abs(diffDays) > 1 ? 's' : ''}`
                    } else if (diffDays > 1 && diffDays <= 7) {
                        return `En ${diffDays} días`
                    }

                    try {
                        return date.toLocaleDateString('es-ES', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric',
                            timeZone: 'UTC',
                        })
                    } catch (e) {
                        return dateString
                    }
                }

                function getIconForPriority(alert) {
                    if (!alert.active) {
                        return `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"></path></svg>`
                    }
                    switch (alert.priority) {
                        case 'alta':
                            return `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`
                        case 'media':
                            return `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.096 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>`
                        case 'baja':
                        default:
                            return `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`
                    }
                }

                function createAlertCardHTML(alert) {
                    const classes = getPriorityClasses(alert)
                    let locationPath = ''
                    if (alert.locationId) {
                        const type = alert.locationId.substring(0, 3)
                        let dbType
                        if (type === 'pro') dbType = 'propiedades'
                        else if (type === 'hab') dbType = 'habitaciones'
                        else if (type === 'alm') dbType = 'almacenamientos'
                        if (dbType) locationPath = getFullPath(dbType, alert.locationId)
                    }

                    const objectName = alert.objectId
                        ? inventoryDB.objetos[alert.objectId]?.nombre
                        : ''
                    const showCheckbox = alertSelectionMode && currentAlertTab === 'past'

                    return `
                    <div class="flex items-start p-4 space-x-4 rounded-lg shadow-sm cursor-pointer card alert-card ${
                        classes.bg
                    } ${classes.border}" data-alert-id="${alert.id}" data-priority="${alert.active ? alert.priority : 'desactivada'}">
                        <div class="p-2 mt-1 ${classes.iconBg} rounded-full flex-shrink-0">
                            <span class="${classes.iconText}">${getIconForPriority(alert)}</span>
                        </div>
                        <div class="flex-grow min-w-0">
                             <div class="flex justify-between items-center">
                                 <p class="font-semibold truncate ${
                                     classes.text
                                 }">${alert.title}</p>
                                 <p class="text-sm font-medium flex-shrink-0 ml-2 ${
                                     classes.text
                                 }">${formatAlertDate(alert.date)}</p>
                             </div>
                             ${
                                 alert.description
                                     ? `<p class="text-sm text-gray-600 dark:text-gray-300 mt-1 truncate">${alert.description}</p>`
                                     : ''
                             }
                             ${
                                 objectName
                                     ? `<p class="text-sm text-gray-500 dark:text-gray-400 mt-2 truncate"><b>Artículo:</b> ${objectName}</p>`
                                     : ''
                             }
                             ${
                                 locationPath
                                     ? `<p class="text-sm text-gray-500 dark:text-gray-400 truncate"><b>Lugar:</b> ${locationPath}</p>`
                                     : ''
                             }
                        </div>
                         ${
                             showCheckbox
                                 ? `
                            <div class="flex items-center justify-center h-full pl-2 flex-shrink-0">
                                <div class="w-5 h-5 border-2 border-gray-400 rounded-full flex items-center justify-center checkmark-icon dark:border-gray-500" style="background-color: transparent;">
                                    <svg class="w-3 h-3 text-white fill-current" viewBox="0 0 20 20">
                                        <path d="M0 11l2-2 5 5L17 3l3 3L7 19z"/>
                                    </svg>
                                </div>
                            </div>
                         `
                                 : ''
                         }
                    </div>
                `
                }

                function renderAlertsScreen() {
                    try {
                        today = new Date().toISOString().split('T')[0]

                        const importantes = alertsDB
                            .filter(a => a.active && a.date >= today && a.priority === 'alta')
                            .sort((a, b) => new Date(a.date) - new Date(b.date))

                        const proximas = alertsDB
                            .filter(a => a.active && a.date >= today && a.priority !== 'alta')
                            .sort((a, b) => new Date(a.date) - new Date(b.date))

                        const desactivadas = alertsDB
                            .filter(a => !a.active)
                            .sort((a, b) => new Date(b.date) - new Date(a.date))

                        const pasadas = alertsDB
                            .filter(a => a.active && a.date < today)
                            .sort((a, b) => new Date(b.date) - new Date(a.date))

                        listImportantes.innerHTML = importantes.length
                            ? importantes.map(a => createAlertCardHTML(a)).join('')
                            : '<p class="py-2 text-center text-gray-500 dark:text-gray-400">No hay alertas importantes.</p>'
                        listProximas.innerHTML = proximas.length
                            ? proximas.map(a => createAlertCardHTML(a)).join('')
                            : '<p class="py-2 text-center text-gray-500 dark:text-gray-400">No hay más alertas próximas.</p>'
                        listDesactivadas.innerHTML = desactivadas.length
                            ? desactivadas.map(a => createAlertCardHTML(a)).join('')
                            : '<p class="py-2 text-center text-gray-500 dark:text-gray-400">No hay alertas desactivadas.</p>'
                        listPast.innerHTML = pasadas.length
                            ? pasadas.map(a => createAlertCardHTML(a)).join('')
                            : '<p class="py-10 text-center text-gray-500 dark:text-gray-400">No hay alertas pasadas.</p>'

                        addAlertCardClickListeners()
                    } catch (error) {
                        console.error('Error rendering alerts:', error)
                        listActuales.innerHTML =
                            "<p class='text-red-500 p-4'>Error al cargar las alertas.</p>"
                        listPast.innerHTML =
                            "<p class='text-red-500 p-4'>Error al cargar las alertas.</p>"
                    }
                }

                function addAlertCardClickListeners() {
                    document.querySelectorAll('#screen-alerts .alert-card').forEach(card => {
                        card.onclick = null // Prevenir duplicados
                        card.addEventListener('click', () => {
                            const alertId = card.dataset.alertId
                            const alert = alertsDB.find(a => a.id === alertId)
                            if (!alert) return

                            if (alertSelectionMode && currentAlertTab === 'past') {
                                card.classList.toggle('selected')
                                const checkmark = card.querySelector('.checkmark-icon')
                                if (!checkmark) return
                                if (card.classList.contains('selected')) {
                                    checkmark.style.backgroundColor = '#3b82f6'
                                    checkmark.style.borderColor = '#3b82f6'
                                } else {
                                    checkmark.style.backgroundColor = 'transparent'
                                    checkmark.style.borderColor = appFrame.classList.contains(
                                        'dark'
                                    )
                                        ? '#6b7280'
                                        : '#9ca3af'
                                }
                            } else {
                                openViewAlertModal(alert)
                            }
                        })
                    })
                }

                function openAlertModal(alert = null) {
                    if (alert) {
                        alertModalTitle.textContent = 'Modificar Alerta'
                        saveAlertBtn.textContent = 'Guardar Cambios'
                        modalAddAlert.dataset.editingId = alert.id

                        console.log(alert)
                        console.log(alertTitleInput)

                        alertTitleInput.value = alert.title
                        alertDescriptionInput.value = alert.description
                        alertDateInput.value = alert.date
                        alertPriorityInput.value = alert.priority
                        alertLocationInput.value = alert.locationId
                        alertObjectInput.value = alert.objectId
                        alertRepetitiveCheckbox.checked = alert.repetitive
                        alertRepeatFrequencyInput.value = alert.repeatFrequency
                    } else {
                        alertModalTitle.textContent = 'Añadir Nueva Alerta'
                        saveAlertBtn.textContent = 'Guardar Alerta'
                        modalAddAlert.dataset.editingId = ''

                        alertTitleInput.value = ''
                        alertDescriptionInput.value = ''
                        alertDateInput.value = ''
                        alertPriorityInput.value = 'baja'
                        alertLocationInput.value = ''
                        alertObjectInput.value = ''
                        alertRepetitiveCheckbox.checked = false
                    }

                    alertRepetitiveCheckbox.dispatchEvent(new Event('change'))
                    modalAddAlert.classList.remove('hidden')
                    modalAddAlert.classList.add('flex')
                }

                function closeAlertModal() {
                    modalAddAlert.classList.add('hidden')
                    modalAddAlert.classList.remove('flex')
                }

                function openViewAlertModal(alert) {
                    modalViewAlert.dataset.alertId = alert.id
                    viewAlertTitle.textContent = alert.title
                    viewAlertDate.textContent =
                        formatAlertDate(alert.date) +
                        (alert.repetitive ? ` (Repite ${alert.repeatFrequency})` : '')
                    viewAlertDescription.textContent = alert.description || 'Sin descripción.'

                    let locationPath = ''
                    if (alert.locationId) {
                        const type = alert.locationId.substring(0, 3)
                        let dbType
                        if (type === 'pro') dbType = 'propiedades'
                        else if (type === 'hab') dbType = 'habitaciones'
                        else if (type === 'alm') dbType = 'almacenamientos'
                        if (dbType) locationPath = getFullPath(dbType, alert.locationId)
                    }
                    const objectName = alert.objectId
                        ? inventoryDB.objetos[alert.objectId]?.nombre
                        : ''
                    let locationHTML = ''
                    if (objectName) locationHTML += `<p><b>Objeto:</b> ${objectName}</p>`
                    if (locationPath) locationHTML += `<p><b>Lugar:</b> ${locationPath}</p>`
                    viewAlertLocation.innerHTML = locationPath
                    viewAlertObject.innerHTML = objectName

                    if (!alert.active) {
                        alertModalModify.classList.add('hidden')
                        alertModalDeactivate.classList.add('hidden')
                        alertModalReactivate.classList.remove('hidden')
                        alertModalDelete.classList.remove('hidden')
                    } else if (alert.active && alert.date < today) {
                        // Pasada
                        alertModalModify.classList.remove('hidden')
                        alertModalDeactivate.classList.remove('hidden')
                        alertModalReactivate.classList.add('hidden')
                        alertModalDelete.classList.remove('hidden')
                    } else {
                        // Actual
                        alertModalModify.classList.remove('hidden')
                        alertModalDeactivate.classList.remove('hidden')
                        alertModalReactivate.classList.add('hidden')
                        alertModalDelete.classList.remove('hidden')
                    }

                    modalViewAlert.classList.remove('hidden')

                    modalViewAlert.classList.add('flex')
                }

                function closeViewAlertModal() {
                    modalViewAlert.classList.add('hidden')
                    modalViewAlert.classList.remove('flex')
                }

                function toggleAlertSelectionMode(forceState) {
                    const newState = forceState ?? !alertSelectionMode
                    if (currentAlertTab !== 'past' && newState) return

                    alertSelectionMode = newState

                    if (alertSelectionMode) {
                        alertEditBtn.textContent = 'Cancelar'
                        alertSelectionFooter.classList.remove('hidden')
                        openAlertModalBtn.classList.add('hidden')
                    } else {
                        alertEditBtn.textContent = 'Eliminar'
                        alertSelectionFooter.classList.add('hidden')
                        openAlertModalBtn.classList.remove('hidden')
                        // Deseleccionar todo
                        document
                            .querySelectorAll('#alert-list-past .alert-card.selected')
                            .forEach(card => {
                                card.classList.remove('selected')
                                const checkmark = card.querySelector('.checkmark-icon')
                                if (checkmark) {
                                    checkmark.style.backgroundColor = 'transparent'
                                    checkmark.style.borderColor = appFrame.classList.contains(
                                        'dark'
                                    )
                                        ? '#6b7280'
                                        : '#9ca3af'
                                }
                            })
                    }

                    // Re-renderizar solo la pestaña 'past' para mostrar/ocultar checkboxes
                    if (currentAlertTab === 'past') {
                        const pasadas = alertsDB
                            .filter(a => a.active && a.date < today)
                            .sort((a, b) => new Date(b.date) - new Date(a.date))
                        listPast.innerHTML = pasadas.length
                            ? pasadas.map(a => createAlertCardHTML(a)).join('')
                            : '<p class="py-10 text-center text-gray-500 dark:text-gray-400">No hay alertas pasadas.</p>'
                        addAlertCardClickListeners()
                    }
                }

                function populateAlertModalSelects() {
                    // Llenar Ubicaciones
                    populateUbicaciones(alertLocationInput)

                    // Llenar Objetos
                    alertObjectInput.innerHTML = '<option value="">Ninguno</option>'
                    let objectsHTML = ''
                    inventoryDB.propiedades.forEach(prop => {
                        let currentGroupLabel = prop.nombre
                        let propLevelObjectsHTML = ''

                        const findObjectsRecursive = (parentId, indentLevel) => {
                            let itemsHtml = ''
                            Object.keys(inventoryDB.objetos).forEach(objId => {
                                if (inventoryDB.objetos[objId].parent === parentId) {
                                    itemsHtml += `<option value="${objId}">${'&nbsp;'.repeat(
                                        indentLevel * 2
                                    )}${inventoryDB.objetos[objId].nombre}</option>`
                                }
                            })

                            let childrenIds = []
                            if (inventoryDB.propiedades.find(p => p.id === parentId))
                                childrenIds = inventoryDB.propiedades.find(
                                    p => p.id === parentId
                                ).children
                            else if (inventoryDB.habitaciones[parentId])
                                childrenIds = inventoryDB.habitaciones[parentId].children
                            else if (inventoryDB.almacenamientos[parentId])
                                childrenIds = inventoryDB.almacenamientos[parentId].children

                            childrenIds.forEach(childId => {
                                let childName = ''
                                let isContainer = false
                                if (inventoryDB.habitaciones[childId]) {
                                    childName = inventoryDB.habitaciones[childId].nombre
                                    isContainer = true
                                } else if (inventoryDB.almacenamientos[childId]) {
                                    childName = inventoryDB.almacenamientos[childId].nombre
                                    isContainer = true
                                }

                                if (isContainer) {
                                    const subItemsHtml = findObjectsRecursive(
                                        childId,
                                        indentLevel + 1
                                    )
                                    if (subItemsHtml) {
                                        itemsHtml += `<optgroup label="${'&nbsp;'.repeat(
                                            indentLevel * 2
                                        )}${childName}">${subItemsHtml}</optgroup>`
                                    }
                                }
                            })
                            return itemsHtml
                        }

                        propLevelObjectsHTML = findObjectsRecursive(prop.id, 0)

                        if (propLevelObjectsHTML) {
                            objectsHTML += `<optgroup label="${prop.nombre}">${propLevelObjectsHTML}</optgroup>`
                        }
                    })
                    alertObjectInput.innerHTML += objectsHTML
                }

                // --- NUEVOS LISTENERS DE ALERTA ---
                openAlertModalBtn.addEventListener('click', () => openAlertModal(null))
                closeAlertModalBtn.addEventListener('click', closeAlertModal)

                saveAlertBtn.addEventListener('click', e => {
                    e.preventDefault()

                    console.log('Guardando alerta...')
                    // return
                    const id = modalAddAlert.dataset.editingId
                    if (!alertTitleInput.value.trim() || !alertDateInput.value) {
                        console.log('Control 1')
                        // Reemplazar alert() con una indicación visual
                        alertTitleInput.classList.add('border-red-500')
                        alertDateInput.classList.add('border-red-500')
                        setTimeout(() => {
                            alertTitleInput.classList.remove('border-red-500')
                            alertDateInput.classList.remove('border-red-500')
                        }, 2000)
                        // return
                    }
                    // return

                    const newAlert = {
                        id: id || `alert${Date.now()}`,
                        title: alertTitleInput.value.trim(),
                        description: alertDescriptionInput.value.trim(),
                        date: alertDateInput.value,
                        priority: alertPriorityInput.value,
                        locationId: alertLocationInput.value,
                        objectId: alertObjectInput.value,
                        repetitive: alertRepetitiveCheckbox.checked,
                        repeatFrequency: alertRepetitiveCheckbox.checked
                            ? alertRepeatFrequencyInput.value
                            : null,
                        active: true,
                    }
                    console.log('Guarando alerta', newAlert)

                    if (id) {
                        const index = alertsDB.findIndex(a => a.id === id)
                        if (index !== -1) alertsDB[index] = newAlert
                        else alertsDB.push(newAlert)
                    } else {
                        alertsDB.push(newAlert)
                    }

                    showSavedOk()

                    closeAlertModal()
                    renderAlertsScreen()
                    // Confirmación visual
                })

                alertRepetitiveCheckbox.addEventListener('change', () => {
                    alertRepeatOptions.classList.toggle('hidden', !alertRepetitiveCheckbox.checked)
                })

                alertModalCancel.addEventListener('click', closeViewAlertModal)

                alertModalDelete.addEventListener('click', () => {
                    // Mostrar modal de confirmación en lugar de eliminar directamente
                    const confirmDeleteAlertModal = document.getElementById(
                        'confirm-delete-alert-modal'
                    )
                    if (confirmDeleteAlertModal) {
                        confirmDeleteAlertModal.classList.remove('hidden')
                    }
                })

                alertModalDeactivate.addEventListener('click', () => {
                    const id = modalViewAlert.dataset.alertId
                    const index = alertsDB.findIndex(a => a.id === id)
                    if (index !== -1) alertsDB[index].active = false
                    closeViewAlertModal()
                    renderAlertsScreen()
                })

                alertModalReactivate.addEventListener('click', () => {
                    const id = modalViewAlert.dataset.alertId
                    const index = alertsDB.findIndex(a => a.id === id)
                    if (index !== -1) {
                        alertsDB[index].active = true
                        // Opcional: si la fecha es pasada, actualizarla a hoy
                        if (alertsDB[index].date < today) {
                            alertsDB[index].date = today
                        }
                    }
                    closeViewAlertModal()
                    renderAlertsScreen()
                })

                alertModalModify.addEventListener('click', () => {
                    const id = modalViewAlert.dataset.alertId
                    const alert = alertsDB.find(a => a.id === id)
                    if (alert) {
                        closeViewAlertModal()
                        openAlertModal(alert)
                    }
                })

                alertTabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const tabName = tab.dataset.tab
                        currentAlertTab = tabName

                        alertTabs.forEach(t => {
                            t.classList.remove('text-blue-600', 'border-blue-600', 'border-b-2')
                            // t.classList.remove
                            t.classList.add('text-gray-500', 'dark:text-gray-400')
                        })
                        tab.classList.add('text-blue-600', 'border-blue-600', 'border-b-2')

                        tab.classList.remove('text-gray-500', 'dark:text-gray-400')

                        alertLists.forEach(list => list.classList.add('hidden'))
                        document.getElementById(`alert-list-${tabName}`).classList.remove('hidden')

                        if (tabName === 'past') {
                            alertEditBtn.classList.remove('hidden')
                            alertSelectionFooter.classList.toggle('hidden', !alertSelectionMode)
                        } else {
                            alertEditBtn.classList.add('hidden')
                            alertSelectionFooter.classList.add('hidden')
                            if (alertSelectionMode) toggleAlertSelectionMode(false) // Salir del modo edición
                        }
                    })
                })

                alertEditBtn.addEventListener('click', () => toggleAlertSelectionMode())

                alertDeleteSelectedBtn.addEventListener('click', () => {
                    const selectedIds = []
                    document
                        .querySelectorAll('#alert-list-past .alert-card.selected')
                        .forEach(card => {
                            selectedIds.push(card.dataset.alertId)
                        })

                    if (selectedIds.length > 0) {
                        // Mostrar modal de confirmación en lugar de eliminar directamente
                        const confirmDeleteSelectedAlertsModal = document.getElementById(
                            'confirm-delete-selected-alerts-modal'
                        )
                        if (confirmDeleteSelectedAlertsModal) {
                            confirmDeleteSelectedAlertsModal.classList.remove('hidden')
                        }
                    } else {
                        // No usar alert()
                        console.warn('No hay alertas seleccionadas para eliminar.')
                    }
                })

                // --- MODAL DE CONFIRMACIÓN PARA ELIMINAR ALERTA ---
                const confirmDeleteAlertModal = document.getElementById(
                    'confirm-delete-alert-modal'
                )
                const confirmDeleteAlertCancelBtn = document.getElementById(
                    'confirm-delete-alert-cancel-btn'
                )
                const confirmDeleteAlertConfirmBtn = document.getElementById(
                    'confirm-delete-alert-confirm-btn'
                )

                // Cancelar eliminación de alerta
                if (confirmDeleteAlertCancelBtn && confirmDeleteAlertModal) {
                    confirmDeleteAlertCancelBtn.addEventListener('click', () => {
                        confirmDeleteAlertModal.classList.add('hidden')
                    })
                }

                // Confirmar eliminación de alerta
                if (confirmDeleteAlertConfirmBtn && confirmDeleteAlertModal) {
                    confirmDeleteAlertConfirmBtn.addEventListener('click', () => {
                        const id = modalViewAlert.dataset.alertId
                        alertsDB = alertsDB.filter(a => a.id !== id)
                        confirmDeleteAlertModal.classList.add('hidden')
                        closeViewAlertModal()
                        renderAlertsScreen()
                    })
                }

                // --- MODAL DE CONFIRMACIÓN PARA ELIMINAR ALERTAS SELECCIONADAS ---
                const confirmDeleteSelectedAlertsModal = document.getElementById(
                    'confirm-delete-selected-alerts-modal'
                )
                const confirmDeleteSelectedAlertsCancelBtn = document.getElementById(
                    'confirm-delete-selected-alerts-cancel-btn'
                )
                const confirmDeleteSelectedAlertsConfirmBtn = document.getElementById(
                    'confirm-delete-selected-alerts-confirm-btn'
                )

                // Cancelar eliminación de alertas seleccionadas
                if (confirmDeleteSelectedAlertsCancelBtn && confirmDeleteSelectedAlertsModal) {
                    confirmDeleteSelectedAlertsCancelBtn.addEventListener('click', () => {
                        confirmDeleteSelectedAlertsModal.classList.add('hidden')
                    })
                }

                // Confirmar eliminación de alertas seleccionadas
                if (confirmDeleteSelectedAlertsConfirmBtn && confirmDeleteSelectedAlertsModal) {
                    confirmDeleteSelectedAlertsConfirmBtn.addEventListener('click', () => {
                        const selectedIds = []
                        document
                            .querySelectorAll('#alert-list-past .alert-card.selected')
                            .forEach(card => {
                                selectedIds.push(card.dataset.alertId)
                            })

                        if (selectedIds.length > 0) {
                            alertsDB = alertsDB.filter(a => !selectedIds.includes(a.id))
                            toggleAlertSelectionMode(false) // Sale del modo edición y re-renderiza
                        }

                        confirmDeleteSelectedAlertsModal.classList.add('hidden')
                    })
                }

                // --- INICIALIZACIÓN ---
                renderHomeCategories()
                renderRecentlyAdded()
                populateAlertModalSelects() // <-- NUEVO
                // Mostrar login si no está logueado
                if (!isLoggedIn) {
                    showLoginScreen()
                } else {
                    showScreen('home')
                    document
                        .querySelector('.nav-button[data-screen="home"]')
                        .classList.add(activeTextColorClass, activeNavButtonClass)
                    document
                        .querySelector('.nav-button[data-screen="home"]')
                        .classList.remove(inactiveTextColorClass, darkInactiveTextColorClass)
                }
            })

            document.addEventListener('DOMContentLoaded', function () {
                // elementos principales del panel de notificaciones
                const notifSwitch = document.getElementById('notif-switch')

                // engranaje y panel
                const notifConfigBtn = document.getElementById('notif-config-btn') // botón ⚙
                const notifConfigPanel = document.getElementById('notif-config-panel') // panel desplegable

                // vamos a recordar si ya inicializamos vibración por defecto
                let notifPanelInitialized = false

                // helper: prender vibración para todas las categorías la primera vez
                function initDefaultVibration() {
                    if (notifPanelInitialized) return
                    notifPanelInitialized = true

                    // todos los toggles con clase .default-vibration empiezan activos
                    document
                        .querySelectorAll('#notif-config-panel .default-vibration')
                        .forEach(cb => {
                            cb.checked = true
                        })
                }

                // al cambiar el switch global
                if (notifSwitch) {
                    notifSwitch.addEventListener('change', function () {
                        if (notifSwitch.checked) {
                            // mostrar engranaje directamente
                            if (notifConfigBtn) {
                                notifConfigBtn.classList.remove('hidden')
                            }
                            // inicializar vibración por defecto
                            initDefaultVibration()
                        } else {
                            // al apagar todo:
                            // esconder panel y engranaje
                            if (notifConfigPanel) {
                                notifConfigPanel.classList.add('hidden')
                            }
                            if (notifConfigBtn) {
                                notifConfigBtn.classList.add('hidden')
                            }
                        }
                    })
                }

                // al tocar el engranaje
                if (notifConfigBtn && notifConfigPanel && notifSwitch) {
                    notifConfigBtn.addEventListener('click', function () {
                        if (!notifSwitch.checked) return // seguridad

                        // inicializar defaults (vibración encendida en todas las categorías)
                        initDefaultVibration()

                        // toggle panel
                        notifConfigPanel.classList.toggle('hidden')
                    })
                }
            })
            function populateCategorySelect(selectedValue) {
                const detailCategory = document.getElementById('detail-category') // ahora va a ser <select>
                // Rellenar el <select> de categoría con opciones conocidas
                // y marcar la actual
                if (!detailCategory) return
                detailCategory.innerHTML = '' // limpiamos

                knownCategories.forEach(cat => {
                    const opt = document.createElement('option')
                    opt.value = cat
                    opt.textContent = cat
                    if (cat === selectedValue) {
                        opt.selected = true
                    }
                    detailCategory.appendChild(opt)
                })
            }
            const detailLocationList = document.getElementById('detail-location-list') // lo vamos a crear
            const detailImage = document.getElementById('detail-image')
            const detailName = document.getElementById('detail-name')
            const detailLocation = document.getElementById('detail-location')
            const detailQty = document.getElementById('detail-qty')
            const detailCategory = document.getElementById('detail-category') // ahora va a ser <select>
            const detailNotes = document.getElementById('detail-notes')

            function openObjectDetail(objectId) {
                console.log('abrir detalle de:', objectId)
                const obj = objectDB[objectId]
                if (!obj) return

                currentObjectId = objectId

                // Llenar UI
                detailImage.src = obj.img || ''
                detailImage.alt = obj.nombre || 'Objeto'

                detailName.value = obj.nombre || ''
                // Mostrar la ubicación con el símbolo ► en vez de > solo visualmente
                if (obj.ubicacion) {
                    detailLocation.value = obj.ubicacion.replace(/\s*>\s*/g, ' ► ')
                } else {
                    detailLocation.value = ''
                }
                detailQty.value = obj.cantidad != null ? obj.cantidad : ''
                detailNotes.value = obj.notas || ''

                // categoría ahora es <select>, la llenamos dinámicamente
                populateCategorySelect(obj.categoria)
                populateUbicaciones(detailLocation)

                detailLocation.value = obj.ubicacionId || ''
                console.log('ubicaciones conocidas:', knownLocations)
                console.log('ubicación del Artículo:', obj.ubicacionId)

                // ubicaciones sugeridas
                // populateLocationDropdown(obj.ubicacionId)

                // Navegación visual
                hide(screenHome)
                show(screenObjectDetail)
                if (footerNav) hide(footerNav)

                // asegúrate que el panel dropdown de ubicaciones esté oculto al entrar
                if (detailLocationList) hide(detailLocationList)

                // scroll to top del detalle
                screenObjectDetail.scrollTop = 0
            }

            document.addEventListener('DOMContentLoaded', function () {
                // Referencias del modal de vista
                const modalViewObject = document.getElementById('modal-view-object')
                const closeViewObjectBtn = document.getElementById('close-view-object-btn')

                // Campos del modal de vista
                const photoEl = document.getElementById('view-object-photo')
                const photoPlaceholder = document.getElementById('view-object-photo-placeholder')
                const nameEl = document.getElementById('view-object-name')
                const descEl = document.getElementById('view-object-desc')
                const catEl = document.getElementById('view-object-category')
                const qtyEl = document.getElementById('view-object-qty')
                const unitsEl = document.getElementById('view-object-units')
                const locEl = document.getElementById('view-object-location')
                const costEl = document.getElementById('view-object-cost')
                const dateEl = document.getElementById('view-object-date')

                // util: abrir modal con datos

                // listeners para cada item reciente
                const recentTaladro = document.getElementById('recent-taladro')
                const recentPasaporte = document.getElementById('recent-pasaporte')
                const recentTele = document.getElementById('recent-tele')
                const recentLibro = document.getElementById('recent-libro')

                if (recentTaladro) {
                    recentTaladro.addEventListener('click', function () {
                        openObjectDetail({
                            photo: 'img/taladro.jpg',
                            name: 'Taladro Inalámbrico',
                            desc: 'Taladro inalámbrico de batería para uso doméstico.',
                            category: 'Herramientas',
                            qty: 1,
                            units: 'Unidades',
                            location: 'Casa Principal ► Garaje ► Caja Herramientas',
                            cost: '45',
                            buyDate: '2025-09-10',
                        })
                    })
                }

                if (recentPasaporte) {
                    recentPasaporte.addEventListener('click', function () {
                        openObjectDetail({
                            photo: 'img/pasaporte.jpg',
                            name: 'Pasaporte',
                            desc: 'Documentación oficial, importante, vencer en 2027.',
                            category: 'Documentos',
                            qty: 1,
                            units: 'Unidades',
                            location: 'Oficina > Escritorio > Cajón 1',
                            cost: '',
                            buyDate: '',
                        })
                    })
                }

                if (recentTele) {
                    recentTele.addEventListener('click', function () {
                        openObjectDetail({
                            photo: 'img/tele.jpg',
                            name: 'Televisión Salón',
                            desc: 'Televisión 55" 4K del salón.',
                            category: 'Electrónica',
                            qty: 1,
                            units: 'Unidades',
                            location: 'Casa Principal ► Sala ► Mueble TV',
                            cost: '650',
                            buyDate: '2024-06-15',
                        })
                    })
                }

                if (recentLibro) {
                    recentLibro.addEventListener('click', function () {
                        openObjectDetail({
                            photo: 'img/libro.jpg',
                            name: "Libro 'El Hobbit'",
                            desc: 'Edición de colección.',
                            category: 'Alimentos', // <- cámbialo si tienes "Libros" luego
                            qty: 1,
                            units: 'Unidades',
                            location: 'Casa Principal ► Dormitorio ► Librero',
                            cost: '20',
                            buyDate: '2023-12-01',
                        })
                    })
                }
            })
        </script>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                // wrappers
                const homeDefaultWrapper = document.getElementById('home-default-wrapper')
                const homeSearchWrapper = document.getElementById('home-search-wrapper')

                // inputs
                const searchInputIdle = document.getElementById('search-input') // el de modo normal
                const searchInputActive = document.getElementById('search-input-active') // el de modo búsqueda

                // botones
                const searchExitBtn = document.getElementById('search-exit-btn') // X grande en modo búsqueda

                // contenedor resultados
                const resultsBox = document.getElementById('home-search-results')

                // inventario simulado
                const inventoryObjects = [
                    {
                        id: 'tele',
                        nombre: 'Televisión',
                        img: 'img/tele.jpg',
                        ubicacion: 'Casa Principal ► Sala',
                    },
                    {
                        id: 'arroz',
                        nombre: 'Paquete de arroz',
                        img: 'img/arroz.jpg',
                        ubicacion: 'Casa Principal ► Cocina ► Despensa',
                    },
                    {
                        id: 'leche',
                        nombre: 'Leche Entera',
                        img: 'img/leche.jpg',
                        ubicacion: 'Casa Principal ► Cocina ► Refrigerador',
                    },
                    {
                        id: 'taladro',
                        nombre: 'Taladro Inalámbrico',
                        img: 'img/taladro.jpg',
                        ubicacion: 'Casa Principal ► Garaje ► Caja Herramientas',
                    },
                    {
                        id: 'pasaporte',
                        nombre: 'Pasaporte',
                        img: 'img/pasaporte.jpg',
                        ubicacion: 'Oficina > Escritorio > Cajón 1',
                    },
                    {
                        id: 'libro',
                        nombre: "Libro 'El Hobbit'",
                        img: 'img/libro.jpg',
                        ubicacion: 'Librero > Sala',
                    },
                ]

                // helpers
                function goToSearchMode() {
                    homeDefaultWrapper.classList.add('hidden')
                    homeSearchWrapper.classList.remove('hidden')
                    homeSearchWrapper.classList.add('block')
                    // copiar el texto que el user escribió en el input normal -> input activo
                    searchInputActive.value = searchInputIdle.value
                    searchInputActive.focus()
                    doSearch(searchInputActive.value)
                }

                function goToHomeMode() {
                    // limpiar ambos inputs
                    searchInputIdle.value = ''
                    searchInputActive.value = ''
                    // vaciar resultados
                    resultsBox.innerHTML = ''
                    // volver a mostrar home normal
                    homeSearchWrapper.classList.add('hidden')
                    homeSearchWrapper.classList.remove('block')
                    homeDefaultWrapper.classList.remove('hidden')
                    homeDefaultWrapper.classList.add('block')
                    // enfoque UX vuelve al input idle si quieres
                    // searchInputIdle.focus();
                }

                function renderResults(list) {
                    if (!list || list.length === 0) {
                        resultsBox.innerHTML = `
                <div class="px-4 py-6 text-center text-sm text-gray-500 dark:text-gray-400">
                    No se encontró nada.
                </div>
            `
                        return
                    }

                    const cardsHtml = list
                        .map(
                            obj => `
            <div class="flex flex-col items-start text-left w-32" data-open-object="${obj.id}">
                <div class="w-32 h-32 rounded-lg overflow-hidden bg-gray-200 border border-gray-300 flex items-center justify-center dark:bg-gray-700 dark:border-gray-600">
                    <img src="${obj.img}" alt="${obj.nombre}" class="w-full h-full object-cover">
                </div>
                <div class="mt-2 w-full">
                    <div class="text-sm font-medium text-gray-800 leading-snug truncate dark:text-gray-100">
                        ${obj.nombre}
                    </div>
                    <div class="text-[11px] leading-tight text-gray-500 dark:text-gray-400">
                        ${obj.ubicacion}
                    </div>
                </div>
            </div>
        `
                        )
                        .join('')

                    resultsBox.innerHTML = `
            <div class="px-4 pt-4 pb-2 text-sm font-semibold text-gray-700 dark:text-gray-200">
                Resultados (${list.length})
            </div>
            <div class="border-t border-gray-200 dark:border-gray-700 pt-4 grid grid-cols-2 gap-x-6 gap-y-6 px-4 pb-4">
                ${cardsHtml}
            </div>
        `

                    // si ya tienes openObjectDetailModal(id) lo llamas aquí:
                    const cards = resultsBox.querySelectorAll('[data-open-object]')
                    cards.forEach(card => {
                        card.addEventListener('click', () => {
                            const id = card.getAttribute('data-open-object')
                            // openObjectDetailModal(id);
                        })
                    })
                }

                function doSearch(term) {
                    const q = (term || '').trim().toLowerCase()
                    if (q === '') {
                        renderResults([])
                        return
                    }

                    const matches = inventoryObjects.filter(obj => {
                        return (
                            (obj.nombre && obj.nombre.toLowerCase().includes(q)) ||
                            (obj.ubicacion && obj.ubicacion.toLowerCase().includes(q))
                        )
                    })

                    renderResults(matches)
                }

                // eventos

                // cuando el user escribe en el input idle (home normal)
                if (searchInputIdle) {
                    searchInputIdle.addEventListener('input', () => {
                        // en cuanto empieza a escribir, saltamos al modo búsqueda
                        goToSearchMode()
                    })

                    // si da enter también saltamos
                    searchInputIdle.addEventListener('keyup', e => {
                        if (e.key === 'Enter') {
                            goToSearchMode()
                        }
                    })
                }

                // cuando ya estamos en modo búsqueda y sigue escribiendo
                if (searchInputActive) {
                    searchInputActive.addEventListener('input', e => {
                        doSearch(e.target.value || '')
                    })

                    searchInputActive.addEventListener('keyup', e => {
                        if (e.key === 'Enter') {
                            doSearch(searchInputActive.value || '')
                        }
                    })
                }

                // botón X (salir de búsqueda y volver al home original limpio)
                if (searchExitBtn) {
                    searchExitBtn.addEventListener('click', () => {
                        goToHomeMode()
                    })
                }
            })
        </script>

        <script>
            const screenHome = document.getElementById('screen-home')
            const screenObjectDetail = document.getElementById('screen-object-detail')
            const footerNav = document.querySelector('footer.nav-bar')

            document.addEventListener('DOMContentLoaded', () => {
                const searchInput = document.getElementById('search-input') // input
                const searchClearBtn = document.getElementById('search-clear-btn') // X
                const resultsBox = document.getElementById('home-search-results') // caja de resultados

                // function populateLocationDropdown(currentLocation) {
                //     // Rellenar la lista de ubicaciones sugeridas para que el user pueda tocar una
                //     if (!detailLocationList) return
                //     detailLocationList.innerHTML = ''

                //     knownLocations.forEach(loc => {
                //         const btn = document.createElement('button')
                //         btn.type = 'button'
                //         btn.className =
                //             'w-full text-left px-4 py-2 text-sm hover:bg-blue-50 border-b border-gray-200 last:border-b-0 ' +
                //             'dark:hover:bg-gray-700 dark:border-gray-700'
                //         btn.textContent = loc
                //         btn.addEventListener('click', () => {
                //             detailLocation.value = loc
                //             hide(detailLocationList)
                //         })
                //         detailLocationList.appendChild(btn)
                //     })

                //     // Si la ubicación actual no está en la lista, la primera vez igual la dejamos en el input.
                //     detailLocation.value = currentLocation || ''
                // }

                const inventoryObjects = [
                    {
                        id: 'tele',
                        nombre: 'Televisión Salón',
                        img: 'img/tele.jpg',
                        ubicacion: 'Casa Principal ► Sala',
                    },
                    {
                        id: 'arroz',
                        nombre: 'Paquete de arroz',
                        img: 'img/arroz.jpg',
                        ubicacion: 'Casa Principal ► Cocina ► Despensa',
                    },
                    {
                        id: 'leche',
                        nombre: 'Leche Entera',
                        img: 'img/leche.jpg',
                        ubicacion: 'Casa Principal ► Cocina ► Refrigerador',
                    },
                    {
                        id: 'taladro',
                        nombre: 'Taladro Inalámbrico',
                        img: 'img/taladro.jpg',
                        ubicacion: 'Casa Principal ► Garaje ► Caja Herramientas',
                    },
                    {
                        id: 'pasaporte',
                        nombre: 'Pasaporte',
                        img: 'img/pasaporte.jpg',
                        ubicacion: 'Oficina ► Escritorio ► Cajón 1',
                    },
                    {
                        id: 'libro',
                        nombre: "Libro 'El Hobbit'",
                        img: 'img/libro.jpg',
                        ubicacion: 'Librero ► Sala',
                    },
                ]

                function showResultsBox(show) {
                    if (!resultsBox) return
                    resultsBox.classList.toggle('hidden', !show)
                    resultsBox.classList.toggle('block', show)
                }

                function showClearBtn(show) {
                    if (!searchClearBtn) return
                    searchClearBtn.classList.toggle('hidden', !show)
                }

                function clearSearchUI() {
                    // limpiar input
                    searchInput.value = ''
                    // limpiar contenido resultados
                    resultsBox.innerHTML = ''
                    // ocultar caja resultados y ocultar X
                    showResultsBox(false)
                    showClearBtn(false)
                    // listo: debajo del input vuelven a verse "Objetos Añadidos" porque nunca los quitamos del DOM
                }

                function renderResults(matches) {
                    if (!resultsBox) return

                    if (!matches || matches.length === 0) {
                        resultsBox.innerHTML = `
                    <div class="px-4 py-6 text-center text-sm text-gray-500 dark:text-gray-400">
                        No se encontró nada.
                    </div>
                `
                        return
                    }

                    const cardsHtml = matches
                        .map(
                            obj => `
                <div class="flex flex-col items-start text-left w-32" data-open-object="${obj.id}">
                    <div class="w-32 h-32 rounded-lg overflow-hidden bg-gray-200 border border-gray-300 flex items-center justify-center dark:bg-gray-700 dark:border-gray-600">
                        <img src="${obj.img}" alt="${obj.nombre}" class="w-full h-full object-cover">
                    </div>
                    <div class="mt-2 w-full">
                        <div class="text-sm font-medium text-gray-800 leading-snug truncate dark:text-gray-100">
                            ${obj.nombre}
                        </div>
                        <div class="text-[11px] leading-tight text-gray-500 dark:text-gray-400">
                            ${obj.ubicacion}
                        </div>
                    </div>
                </div>
            `
                        )
                        .join('')

                    resultsBox.innerHTML = `
                <div class="px-4 pt-4 pb-2 text-sm font-semibold text-gray-700 dark:text-gray-200">
                    Resultados (${matches.length})
                </div>
                <div class="border-t border-gray-200 dark:border-gray-700 pt-4 grid grid-cols-2 gap-x-6 gap-y-6 px-4 pb-4">
                    ${cardsHtml}
                </div>
            `
                }

                function doSearch(term) {
                    const q = (term || '').trim().toLowerCase()

                    if (q === '') {
                        clearSearchUI()
                        return
                    }

                    const matches = inventoryObjects.filter(obj => {
                        return (
                            (obj.nombre && obj.nombre.toLowerCase().includes(q)) ||
                            (obj.ubicacion && obj.ubicacion.toLowerCase().includes(q))
                        )
                    })

                    renderResults(matches)
                    showResultsBox(true)
                    showClearBtn(true)
                }

                if (searchInput) {
                    searchInput.addEventListener('input', e => {
                        doSearch(e.target.value || '')
                    })

                    searchInput.addEventListener('keyup', e => {
                        if (e.key === 'Enter') {
                            doSearch(searchInput.value || '')
                        }
                    })

                    searchInput.addEventListener('focus', () => {
                        if ((searchInput.value || '').trim() === '') {
                            clearSearchUI()
                        }
                    })
                }

                if (searchClearBtn) {
                    searchClearBtn.addEventListener('click', e => {
                        e.preventDefault()
                        e.stopPropagation()
                        clearSearchUI()
                    })
                }

                // if (resultsBox) {
                resultsBox.addEventListener('click', e => {
                    //         const card = e.target.closest('[data-open-object]')
                    //         if (!card) return
                    //         const objId = card.getAttribute('data-open-object')
                    //         console.log('abrir detalle de:', objId)
                    //     })
                    // resultsBox.querySelectorAll('[data-open-object]').forEach(card => {
                    const card = e.target.closest('[data-open-object]')
                    if (!card) return
                    // console.log('añadiendo listener a card', card)
                    // card.addEventListener('click', () => {
                    console.log('click en card', card)
                    // console.log(resultBox)
                    const objId = card.getAttribute('data-open-object')
                    console.log('abriendo detalle :', objId)
                    openObjectDetail(objId)
                    // })
                })
                // }
            })
        </script>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                // ---------------------------
                // 1. REFERENCIAS DOM
                // ---------------------------

                // pantallas

                // búsqueda en home
                const searchInput = document.getElementById('search-input')
                const searchClearBtn = document.getElementById('search-clear-btn')
                const resultsBox = document.getElementById('home-search-results')

                // inputs detalle objeto

                // UI auxiliar en detalle
                const detailLocationPickerBtn = document.getElementById(
                    'detail-location-picker-btn'
                ) // lo vamos a crear

                const backBtn = document.getElementById('object-detail-back-btn')
                const saveBtn = document.getElementById('detail-save-btn')
                const deleteBtn = document.getElementById('detail-delete-btn')

                // Modales de confirmación y éxito para eliminar
                const confirmDeleteModal = document.getElementById('confirm-delete-modal')
                const confirmDeleteCancelBtn = document.getElementById('confirm-delete-cancel-btn')
                const confirmDeleteConfirmBtn = document.getElementById(
                    'confirm-delete-confirm-btn'
                )
                const deletedOkModal = document.getElementById('deleted-ok-modal')
                const deletedOkCloseBtn = document.getElementById('deleted-ok-close-btn')

                // Modal de guardado correcto
                const savedOkModal = document.getElementById('saved-ok-modal')
                function populateCategorySelect(selectedValue) {
                    // Rellenar el <select> de categoría con opciones conocidas
                    // y marcar la actual
                    if (!detailCategory) return
                    detailCategory.innerHTML = '' // limpiamos

                    knownCategories.forEach(cat => {
                        const opt = document.createElement('option')
                        opt.value = cat
                        opt.textContent = cat
                        if (cat === selectedValue) {
                            opt.selected = true
                        }
                        detailCategory.appendChild(opt)
                    })
                }
                function populateLocationDropdown(currentLocation) {
                    // Rellenar la lista de ubicaciones sugeridas para que el user pueda tocar una
                    if (!detailLocationList) return
                    detailLocationList.innerHTML = ''

                    knownLocations.forEach(loc => {
                        const btn = document.createElement('button')
                        btn.type = 'button'
                        btn.className =
                            'w-full text-left px-4 py-2 text-sm hover:bg-blue-50 border-b border-gray-200 last:border-b-0 ' +
                            'dark:hover:bg-gray-700 dark:border-gray-700'
                        btn.textContent = loc
                        btn.addEventListener('click', () => {
                            detailLocation.value = loc
                            hide(detailLocationList)
                        })
                        detailLocationList.appendChild(btn)
                    })

                    // Si la ubicación actual no está en la lista, la primera vez igual la dejamos en el input.
                    detailLocation.value = currentLocation || ''
                }

                // ---------------------------
                // 3. HELPERS DE UI GENERAL
                // ---------------------------

                // ---------------------------
                // 4. DETALLE DE OBJETO
                // ---------------------------

                function populateLocationDropdown(currentLocation) {
                    // Rellenar la lista de ubicaciones sugeridas para que el user pueda tocar una
                    if (!detailLocationList) return
                    detailLocationList.innerHTML = ''

                    knownLocations.forEach(loc => {
                        const btn = document.createElement('button')
                        btn.type = 'button'
                        btn.className =
                            'w-full text-left px-4 py-2 text-sm hover:bg-blue-50 border-b border-gray-200 last:border-b-0 ' +
                            'dark:hover:bg-gray-700 dark:border-gray-700'
                        btn.textContent = loc
                        btn.addEventListener('click', () => {
                            detailLocation.value = loc
                            hide(detailLocationList)
                        })
                        detailLocationList.appendChild(btn)
                    })

                    // Si la ubicación actual no está en la lista, la primera vez igual la dejamos en el input.
                    detailLocation.value = currentLocation || ''
                }

                function backToHome() {
                    show(screenHome)
                    hide(screenObjectDetail)
                    if (footerNav) show(footerNav)
                }

                // guardar cambios (mostrar modal de éxito)
                if (saveBtn) {
                    saveBtn.addEventListener('click', () => {
                        console.log('guardar cambios en Artículo', currentObjectId)
                        if (!currentObjectId) return
                        const obj = objectDB[currentObjectId]
                        if (!obj) return

                        obj.nombre = detailName.value.trim()
                        obj.ubicacion = detailLocation.value.trim()
                        obj.cantidad = detailQty.value
                            ? parseInt(detailQty.value, 10)
                            : obj.cantidad
                        obj.categoria = detailCategory.value.trim()
                        obj.notas = detailNotes.value.trim()

                        // aquí podrías hacer persistencia real (localStorage / backend)
                        if (savedOkModal) {
                            savedOkModal.classList.remove('hidden')
                            // autocierre opcional
                            setTimeout(() => {
                                if (!savedOkModal.classList.contains('hidden')) {
                                    savedOkModal.classList.add('hidden')
                                    backToHome()
                                }
                            }, 1500)
                        } else {
                            backToHome()
                        }
                    })
                }

                // eliminar con confirmación y aviso de éxito (solo modal, sin alert/confirm)
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', () => {
                        if (!currentObjectId) return
                        if (confirmDeleteModal) {
                            confirmDeleteModal.classList.remove('hidden')
                        }
                    })
                }

                // Confirmación: cancelar
                if (confirmDeleteCancelBtn && confirmDeleteModal) {
                    confirmDeleteCancelBtn.addEventListener('click', () => {
                        confirmDeleteModal.classList.add('hidden')
                    })
                }

                // Confirmación: aceptar -> eliminar y mostrar éxito
                if (confirmDeleteConfirmBtn && confirmDeleteModal) {
                    confirmDeleteConfirmBtn.addEventListener('click', () => {
                        if (!currentObjectId) {
                            confirmDeleteModal.classList.add('hidden')
                            return
                        }
                        delete objectDB[currentObjectId]
                        currentObjectId = null
                        confirmDeleteModal.classList.add('hidden')
                        if (deletedOkModal) {
                            deletedOkModal.classList.remove('hidden')
                            // autocierre opcional tras 1.5s si no se pulsa el botón
                            setTimeout(() => {
                                if (!deletedOkModal.classList.contains('hidden')) {
                                    deletedOkModal.classList.add('hidden')
                                    backToHome()
                                }
                            }, 1500)
                        } else {
                            backToHome()
                        }
                    })
                }

                // Cerrar modal de éxito manualmente
                if (deletedOkCloseBtn && deletedOkModal) {
                    deletedOkCloseBtn.addEventListener('click', () => {
                        deletedOkModal.classList.add('hidden')
                        backToHome()
                    })
                }

                // back arrow
                if (backBtn) {
                    backBtn.addEventListener('click', () => {
                        backToHome()
                    })
                }

                // desplegar / ocultar lista de ubicaciones sugeridas
                if (detailLocationPickerBtn && detailLocationList) {
                    detailLocationPickerBtn.addEventListener('click', () => {
                        if (detailLocationList.classList.contains('hidden')) {
                            show(detailLocationList)
                        } else {
                            hide(detailLocationList)
                        }
                    })
                }

                // Si el usuario toca fuera del panel de ubicaciones, lo cerramos (mobile-friendly)
                document.addEventListener('click', e => {
                    if (!detailLocationList) return
                    if (
                        !detailLocationList.contains(e.target) &&
                        e.target !== detailLocationPickerBtn
                    ) {
                        hide(detailLocationList)
                    }
                })

                // ---------------------------
                // 5. CLICK EN OBJETOS DEL HOME
                // ---------------------------
                // Importante: ahora SÍ enganchamos los que ya existen en el DOM al cargar.
                document.querySelectorAll('[data-open-object]').forEach(card => {
                    card.addEventListener('click', () => {
                        console.log('click en card')
                        const objId = card.getAttribute('data-open-object')
                        openObjectDetail(objId)
                    })
                })

                // ---------------------------
                // 6. BÚSQUEDA
                // ---------------------------

                function showResultsBox(showIt) {
                    resultsBox.classList.toggle('hidden', !showIt)
                    resultsBox.classList.toggle('block', showIt)
                }

                function showClearBtn(showIt) {
                    searchClearBtn.classList.toggle('hidden', !showIt)
                }

                function clearSearchUI() {
                    searchInput.value = ''
                    resultsBox.innerHTML = ''
                    showResultsBox(false)
                    showClearBtn(false)
                }

                function renderResults(matches) {
                    if (!matches || matches.length === 0) {
                        resultsBox.innerHTML = `
                <div class="px-4 py-6 text-center text-sm text-gray-500 dark:text-gray-400">
                    No se encontró nada.
                </div>
            `
                        return
                    }

                    const cardsHtml = matches
                        .map(
                            obj => `
            <div class="flex flex-col items-start text-left w-32 cursor-pointer" data-open-object="${obj.id}">
                <div class="w-32 h-32 rounded-lg overflow-hidden bg-gray-200 border border-gray-300 flex items-center justify-center dark:bg-gray-700 dark:border-gray-600">
                    <img src="${obj.img}" alt="${obj.nombre}" class="w-full h-full object-cover">
                </div>
                <div class="mt-2 w-full">
                    <div class="text-sm font-medium text-gray-800 leading-snug truncate dark:text-gray-100">
                        ${obj.nombre}
                    </div>
                    <div class="text-[11px] leading-tight text-gray-500 dark:text-gray-400">
                        ${obj.ubicacion}
                    </div>
                </div>
            </div>
        `
                        )
                        .join('')

                    resultsBox.innerHTML = `
            <div class="px-4 pt-4 pb-2 text-sm font-semibold text-gray-700 dark:text-gray-200">
                Resultados (${matches.length})
            </div>
            <div class="border-t border-gray-200 dark:border-gray-700 pt-4 grid grid-cols-2 gap-x-6 gap-y-6 px-4 pb-4">
                ${cardsHtml}
            </div>
        `

                    // 👇 MUY IMPORTANTE:
                    // Re-enganchamos los nuevos resultados para que también abran el detalle
                    resultsBox.querySelectorAll('[data-open-object]').forEach(card => {
                        card.addEventListener('click', () => {
                            const objId = card.getAttribute('data-open-object')
                            openObjectDetail(objId)
                        })
                    })
                }

                function doSearch(term) {
                    const q = (term || '').trim().toLowerCase()

                    if (q === '') {
                        clearSearchUI()
                        return
                    }

                    const matches = inventoryObjects.filter(obj => {
                        return (
                            (obj.nombre && obj.nombre.toLowerCase().includes(q)) ||
                            (obj.ubicacion && obj.ubicacion.toLowerCase().includes(q))
                        )
                    })

                    renderResults(matches)
                    showResultsBox(true)
                    showClearBtn(true)
                }

                // listeners de búsqueda
                if (searchInput) {
                    searchInput.addEventListener('input', e => {
                        doSearch(e.target.value || '')
                    })

                    searchInput.addEventListener('keyup', e => {
                        if (e.key === 'Enter') {
                            doSearch(searchInput.value || '')
                        }
                    })

                    searchInput.addEventListener('focus', () => {
                        if ((searchInput.value || '').trim() === '') {
                            clearSearchUI()
                        }
                    })
                }

                if (searchClearBtn) {
                    searchClearBtn.addEventListener('click', e => {
                        e.preventDefault()
                        e.stopPropagation()
                        clearSearchUI()
                    })
                }
            })
        </script>
        <!-- Modal: Confirmar eliminación -->
        <div
            id="confirm-delete-modal"
            class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/50 backdrop-blur-sm"
        >
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl w-11/12 max-w-sm p-5">
                <div class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-2">
                    Confirmar eliminación
                </div>
                <div class="text-sm text-gray-600 dark:text-gray-300 mb-5">
                    ¿Seguro que deseas borrar este Artículo? Esta acción no se puede deshacer.
                </div>
                <div class="flex justify-end gap-3">
                    <button
                        id="confirm-delete-cancel-btn"
                        type="button"
                        class="px-4 py-2 bg-gray-200 text-black rounded-lg font-semibold hover:bg-gray-300 transition dark:bg-gray-700 dark:text-black dark:hover:bg-gray-600 dark:border dark:border-gray-600"
                    >
                        Cancelar
                    </button>
                    <button
                        id="confirm-delete-confirm-btn"
                        type="button"
                        class="px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700"
                    >
                        Eliminar
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal: Confirmar eliminación de alerta -->
        <div
            id="confirm-delete-alert-modal"
            class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/50 backdrop-blur-sm"
        >
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl w-11/12 max-w-sm p-5">
                <div class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-2">
                    Confirmar eliminación
                </div>
                <div class="text-sm text-gray-600 dark:text-gray-300 mb-5">
                    ¿Estás seguro que deseas eliminar esta alerta? Esta acción no se puede deshacer.
                </div>
                <div class="flex justify-end gap-3">
                    <button
                        id="confirm-delete-alert-cancel-btn"
                        type="button"
                        class="px-4 py-2 bg-gray-200 text-black rounded-lg font-semibold hover:bg-gray-300 transition dark:bg-gray-700 dark:text-black dark:hover:bg-gray-600 dark:border dark:border-gray-600"
                    >
                        Cancelar
                    </button>
                    <button
                        id="confirm-delete-alert-confirm-btn"
                        type="button"
                        class="px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700"
                    >
                        Eliminar Alerta
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal: Confirmar eliminación de alertas seleccionadas -->
        <div
            id="confirm-delete-selected-alerts-modal"
            class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/50 backdrop-blur-sm"
        >
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl w-11/12 max-w-sm p-5">
                <div class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-2">
                    Confirmar eliminación
                </div>
                <div class="text-sm text-gray-600 dark:text-gray-300 mb-5">
                    ¿Estás seguro que deseas eliminar las alertas seleccionadas? Esta acción no se
                    puede deshacer.
                </div>
                <div class="flex justify-end gap-3">
                    <button
                        id="confirm-delete-selected-alerts-cancel-btn"
                        type="button"
                        class="px-4 py-2 bg-gray-200 text-black rounded-lg font-semibold hover:bg-gray-300 transition dark:bg-gray-700 dark:text-black dark:hover:bg-gray-600 dark:border dark:border-gray-600"
                    >
                        Cancelar
                    </button>
                    <button
                        id="confirm-delete-selected-alerts-confirm-btn"
                        type="button"
                        class="px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700"
                    >
                        Eliminar Seleccionadas
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal: Eliminado correctamente -->
        <div
            id="deleted-ok-modal"
            class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/50 backdrop-blur-sm"
        >
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl w-11/12 max-w-sm p-5">
                <div class="flex items-start gap-3">
                    <div
                        class="shrink-0 w-6 h-6 rounded-full bg-green-100 text-green-700 flex items-center justify-center dark:bg-green-900/30 dark:text-green-300"
                    >
                        ✓
                    </div>
                    <div>
                        <div class="text-lg font-semibold text-gray-800 dark:text-gray-100">
                            Eliminado
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-300 mt-1">
                            Artículo eliminado correctamente.
                        </div>
                    </div>
                </div>
                <div class="flex justify-end mt-5">
                    <button
                        id="deleted-ok-close-btn"
                        type="button"
                        class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700"
                    >
                        Aceptar
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal: Guardado correctamente -->
        <div
            id="saved-ok-modal"
            class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/50 backdrop-blur-sm"
        >
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl w-11/12 max-w-sm p-5">
                <div class="flex items-start gap-3">
                    <div
                        class="shrink-0 w-6 h-6 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center dark:bg-blue-900/30 dark:text-blue-300"
                    >
                        ✓
                    </div>
                    <div>
                        <div class="text-lg font-semibold text-gray-800 dark:text-gray-100">
                            Cambios guardados
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-300 mt-1">
                            Se guardaron los cambios correctamente.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
